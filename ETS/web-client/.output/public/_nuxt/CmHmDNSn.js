import{d as te,b as ae,r as u,F as oe,o as le,c as b,e as g,f as d,g as l,w as i,h as a,i as k,j as c,k as R,l as ie,m as se,q as ne,t as m,n as M,s as re,p as de}from"./Bn8s6ksr.js";import ue from"./DREYMDR6.js";import ce from"./DhRU5Jgb.js";import pe from"./wL0GXdHM.js";import me from"./Cj5F3lRc.js";import fe from"./B0mp-r-t.js";import ve from"./BBuG_LZR.js";import{_ as _e}from"./DW4Dnba0.js";import he from"./CY5I-LVS.js";import be from"./Bsd0B2of.js";import{u as ye}from"./Ct7qimw6.js";import{f as ge,d as B,u as z}from"./DOgkogYK.js";import{f as x}from"./ClO3DDpd.js";import"./BarrcHik.js";import"./B2cK24SD.js";import"./CP2X2kCJ.js";import"./okssMqCN.js";import"./DvLZ7Zqz.js";import"./CGQTC3f5.js";import"./Beh2qRuB.js";import"./CVaRbyVJ.js";import"./cLBxPfJA.js";import"./C9DUTysQ.js";import"./8sW4mJZM.js";import"./4am-JueE.js";import"./Xh5iAUju.js";import"./7fOzFieg.js";import"./BmCDhavC.js";import"./DwA5qEtX.js";import"./BXQHskyo.js";import"./Co_e_0iK.js";import"./B7j0Dt9D.js";import"./BFrbZsHQ.js";import"./CQy9NsTI.js";import"./BXRJdK4x.js";import"./7jZtv5KM.js";const ke={class:"main-content"},Ce={class:"card"},xe={class:"flex flex-wrap gap-3 items-center justify-between mb-3"},we={class:"flex items-center gap-3"},$e=d("h4",{class:"m-0 text-xl text-900 font-bold"},"Управление курсами",-1),Ve=d("i",{class:"pi pi-search"},null,-1),De={class:"field my-3"},Pe=d("label",{for:"name"},"Название",-1),Le={key:0,class:"p-error"},Ne={class:"confirmation-content p-3"},Se=d("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Me={key:0},Te={style:{"font-size":"0.90rem"}},Ue={class:"confirmation-content p-3"},Ie=d("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Re={key:0},gt=te({__name:"index",setup(Be){ye({title:"Администрирование категорий"});const T=ae(),{$toast:w}=de(),U=u(),p=u(),v=u(!1),_=u(!1),h=u(!1),s=u({}),f=u(),$=u({global:{value:null,matchMode:oe.CONTAINS}}),C=u(!1);u([]);const V=u([{field:"name",header:"Название"},{field:"description",header:"Описание"},{field:"active",header:"Видимость"},{field:"created_at",header:"Создан"},{field:"updated_at",header:"Обновлен"},{field:"starts_at",header:"Начало"},{field:"ends_at",header:"Конец"},{field:"duration_hours",header:"Время прохождения"}]),y=u(V.value.filter(o=>o.field!=="description"&&o.field!=="duration_hours"&&o.field!=="updated_at")),D=u(!0);le(()=>{P()});const E=()=>{h.value=!0},F=()=>{U.value.exportCSV()},j=o=>{y.value=V.value.filter(t=>o.includes(t))},q=o=>{T.push(`/course/create?id=${o.id}`)},A=o=>{s.value=o,_.value=!0},O=()=>{v.value=!1,C.value=!1},G=o=>{let t=-1;for(let n=0;n<p.value.length;n++)if(p.value[n].id===o){t=n;break}return t},H=()=>{var o;C.value=!0,(o=s==null?void 0:s.value.name)!=null&&o.trim()&&(s.value.id&&updateCourse([s.value.id],s.value.name).then(t=>{p.value[G(s.value.id)]=t,w.add({severity:"success",summary:"Успешно",detail:"Курс обновлен",life:5e3}),v.value=!1,s.value={},P()}).catch(t=>console.error("Error updating course:",t)),v.value=!1,s.value={})},K=()=>{B([s.value.id]).then(o=>{p.value=p.value.filter(t=>t.id!==s.value.id),_.value=!1,s.value={},z(!0),w.add({severity:"success",summary:"Успешно",detail:"Курс удален",life:5e3})}).catch(o=>console.error("Error delete category:",o))},J=()=>{B(f.value.map(o=>o.id)).then(o=>{p.value=p.value.filter(t=>!f.value.includes(t)),h.value=!1,f.value=null,z(!0),w.add({severity:"success",summary:"Успешно",detail:"Курсы удалены",life:5e3})}).catch(o=>console.error("Error delete courses:",o))};function P(){D.value=!0,ge().then(o=>{p.value=o,D.value=!1}).catch(o=>console.error("Error fetching courses:",o))}return(o,t)=>{const n=re,Q=ue,W=ce,I=pe,X=me,Y=fe,L=ve,Z=_e,ee=he,N=be;return b(),g(R,null,[d("div",ke,[d("div",Ce,[l(Q,{class:"mb-4"},{start:i(()=>[l(n,{label:"Добавить",icon:"pi pi-plus",severity:"success",class:"mr-2",onClick:t[0]||(t[0]=e=>a(T).push("/course/create"))}),l(n,{label:"Удалить",icon:"pi pi-trash",severity:"danger",onClick:E,disabled:!a(f)||!a(f).length},null,8,["disabled"])]),end:i(()=>[l(n,{label:"Экспорт",icon:"pi pi-upload",severity:"help",onClick:t[1]||(t[1]=e=>F(e))})]),_:1}),l(ee,{ref_key:"dt",ref:U,value:a(p),selection:a(f),"onUpdate:selection":t[4]||(t[4]=e=>k(f)?f.value=e:null),dataKey:"id",loading:a(D),style:{"max-width":"1500px"},tableStyle:"min-width: 60rem",showGridlines:"",resizableColumns:"",columnResizeMode:"fit",paginator:!0,rows:10,filters:a($),paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,25,50],currentPageReportTemplate:"Показаны {first} до {last} из {totalRecords}"},{header:i(()=>[d("div",xe,[d("div",we,[$e,l(n,{icon:"pi pi-refresh",rounded:"",raised:"",onClick:P})]),l(X,{iconPosition:"left"},{default:i(()=>[l(W,null,{default:i(()=>[Ve]),_:1}),l(I,{modelValue:a($).global.value,"onUpdate:modelValue":t[2]||(t[2]=e=>a($).global.value=e),placeholder:"Поиск..."},null,8,["modelValue"])]),_:1})]),l(Y,{modelValue:a(y),"onUpdate:modelValue":[t[3]||(t[3]=e=>k(y)?y.value=e:null),j],options:a(V),optionLabel:"header",display:"chip",placeholder:"Выберите колонки"},null,8,["modelValue","options"])]),empty:i(()=>[c("Курсы не найдены")]),default:i(()=>[l(L,{selectionMode:"multiple",style:{width:"3rem"},exportable:!1}),(b(!0),g(R,null,ie(a(y),(e,S)=>(b(),se(L,{sortable:"",field:e.field,header:e.header,key:e.field+"_"+S},ne({_:2},[e.field!=="name"&&e.field!=="ends_at"&&e.field!=="starts_at"&&e.field!=="updated_at"&&e.field!=="created_at"&&e.field!=="active"?{name:"body",fn:i(r=>[c(m(r.data[e.field]),1)]),key:"0"}:e.field==="active"?{name:"body",fn:i(r=>[c(m(r.data.active===!0?"Да":"Нет"),1)]),key:"1"}:e.field==="name"?{name:"body",fn:i(r=>[l(Z,{to:`/course/${r.data.id}`},{default:i(()=>[c(m(r.data.name),1)]),_:2},1032,["to"])]),key:"2"}:e.field==="ends_at"?{name:"body",fn:i(r=>[c(m(a(x)(r.data.ends_at)),1)]),key:"3"}:e.field==="starts_at"?{name:"body",fn:i(r=>[c(m(a(x)(r.data.starts_at)),1)]),key:"4"}:e.field==="updated_at"?{name:"body",fn:i(r=>[c(m(a(x)(r.data.updated_at)),1)]),key:"5"}:e.field==="created_at"?{name:"body",fn:i(r=>[c(m(a(x)(r.data.created_at)),1)]),key:"6"}:void 0]),1032,["field","header"]))),128)),l(L,{exportable:!1,style:{width:"2rem"}},{body:i(e=>[l(n,{icon:"pi pi-pencil",outlined:"",rounded:"",class:"mr-2",onClick:S=>q(e.data)},null,8,["onClick"]),l(n,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:S=>A(e.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","loading","filters"])])]),l(N,{visible:a(v),"onUpdate:visible":t[6]||(t[6]=e=>k(v)?v.value=e:null),style:{width:"450px"},header:"Детали курса",modal:!0,class:"p-fluid"},{footer:i(()=>[l(n,{label:"Отмена",icon:"pi pi-times",text:"",onClick:O}),l(n,{label:"Сохранить",icon:"pi pi-check",text:"",onClick:H})]),default:i(()=>[d("div",De,[Pe,l(I,{class:"mt-2",id:"name",modelValue:a(s).name,"onUpdate:modelValue":t[5]||(t[5]=e=>a(s).name=e),modelModifiers:{trim:!0},required:"",invalid:a(C)&&!a(s).name},null,8,["modelValue","invalid"]),a(C)&&!a(s).name?(b(),g("small",Le,"Название курса обязательно для заполнения.")):M("",!0)])]),_:1},8,["visible"]),l(N,{visible:a(_),"onUpdate:visible":t[8]||(t[8]=e=>k(_)?_.value=e:null),style:{width:"500px"},header:"Подтверждение",modal:!0},{footer:i(()=>[l(n,{label:"Нет",icon:"pi pi-times",text:"",onClick:t[7]||(t[7]=e=>_.value=!1)}),l(n,{label:"Да",icon:"pi pi-check",text:"",onClick:K})]),default:i(()=>[d("div",Ne,[Se,a(s)?(b(),g("span",Me,[c("Вы действительно хотите удалить категорию "),d("b",null,m(a(s).name),1),c(),d("span",Te,m(a(s).username)+"?",1)])):M("",!0)])]),_:1},8,["visible"]),l(N,{visible:a(h),"onUpdate:visible":t[10]||(t[10]=e=>k(h)?h.value=e:null),style:{width:"450px"},header:"Подтверждение",modal:!0},{footer:i(()=>[l(n,{label:"Нет",icon:"pi pi-times",text:"",onClick:t[9]||(t[9]=e=>h.value=!1)}),l(n,{label:"Да",icon:"pi pi-check",text:"",onClick:J})]),default:i(()=>[d("div",Ue,[Ie,a(s)?(b(),g("span",Re,"Вы действительно хотите удалить выделенные курсы?")):M("",!0)])]),_:1},8,["visible"])],64)}}});export{gt as default};
