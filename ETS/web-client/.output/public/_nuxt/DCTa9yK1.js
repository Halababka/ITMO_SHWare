import{u as x,a as oe,d as ae,b as ie,r as m,F as se,o as le,c as y,e as _,f as u,g as a,w as n,h as i,i as k,j as w,k as B,l as re,m as ne,t as N,n as F,s as ce,p as de}from"./Bn8s6ksr.js";import ue from"./CzsHIdTH.js";import pe from"./DREYMDR6.js";import me from"./DhRU5Jgb.js";import fe from"./wL0GXdHM.js";import ve from"./Cj5F3lRc.js";import ge from"./B0mp-r-t.js";import he from"./BBuG_LZR.js";import ye from"./CY5I-LVS.js";import be from"./Bsd0B2of.js";import{u as Ce}from"./Ct7qimw6.js";import"./BFrbZsHQ.js";import"./DvLZ7Zqz.js";import"./3ww00xj7.js";import"./B2cK24SD.js";import"./BLi23Xor.js";import"./CGQTC3f5.js";import"./B0eqC23B.js";import"./BarrcHik.js";import"./CP2X2kCJ.js";import"./okssMqCN.js";import"./Beh2qRuB.js";import"./CVaRbyVJ.js";import"./cLBxPfJA.js";import"./C9DUTysQ.js";import"./8sW4mJZM.js";import"./4am-JueE.js";import"./Xh5iAUju.js";import"./7fOzFieg.js";import"./BmCDhavC.js";import"./DwA5qEtX.js";import"./BXQHskyo.js";import"./Co_e_0iK.js";import"./B7j0Dt9D.js";import"./CQy9NsTI.js";const $=oe(),_e=async()=>{try{const c=await fetch(`${$.public.apiBase}/categories`,{method:"GET",headers:{Authorization:`${x("token").value}`}});if(!c.ok){const d=await c.json();throw{status:c.status,message:d.error||"Failed fetch Categories"}}return await c.json()}catch(c){throw console.error("Error fetch Categories:",c),c}},ke=async c=>{try{const l=await fetch(`${$.public.apiBase}/categories`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`${x("token").value}`},body:JSON.stringify({names:c})});if(!l.ok){const p=await l.json();throw{status:l.status,message:p.error||"Failed create Categories"}}return await l.json()}catch(l){throw console.error("Error create Categories:",l),l}},we=async(c,l)=>{try{const d=await fetch(`${$.public.apiBase}/categories`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`${x("token").value}`},body:JSON.stringify({ids:c,name:l})});if(!d.ok){const f=await d.json();throw{status:d.status,message:f.error||"Failed update Categories"}}return await d.json()}catch(d){throw console.error("Error updating Categories:",d),d}},L=async c=>{try{const l=await fetch(`${$.public.apiBase}/categories`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`${x("token").value}`},body:JSON.stringify({ids:c})});if(!l.ok)throw new Error("Failed to delete Categories");return await l.json()}catch(l){throw console.error("Error deleting Categories:",l),l}},xe={class:"main-content"},$e={class:"card"},Ee={class:"flex flex-wrap gap-3 items-center justify-between mb-3"},Te={class:"flex items-center gap-3"},Ve=u("h4",{class:"m-0 text-xl text-900 font-bold"},"Управление категориями",-1),De=u("i",{class:"pi pi-search"},null,-1),Pe={class:"field my-3"},Se=u("label",{for:"name"},"Название",-1),je={key:0,class:"p-error"},Ne={class:"confirmation-content p-3"},Fe=u("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),ze={key:0},Be={style:{"font-size":"0.90rem"}},Le={class:"confirmation-content p-3"},Ue=u("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Ie={key:0},_t=ae({__name:"index",setup(c){Ce({title:"Администрирование категорий"}),ie();const{$toast:l}=de(),d=m(),p=m(),f=m(!1),g=m(!1),h=m(!1),t=m({}),v=m(),E=m({global:{value:null,matchMode:se.CONTAINS}}),b=m(!1);m([]);const T=m([{field:"name",header:"Название"}]),C=m(T.value),V=m(!0);le(()=>{D()});const U=()=>{t.value={},b.value=!1,f.value=!0},I=()=>{h.value=!0},M=()=>{d.value.exportCSV()},R=s=>{C.value=T.value.filter(e=>s.includes(e))},A=s=>{t.value={...s},f.value=!0,console.log(t)},O=s=>{t.value=s,g.value=!0},J=()=>{f.value=!1,b.value=!1},G=s=>{let e=-1;for(let r=0;r<p.value.length;r++)if(p.value[r].id===s){e=r;break}return e},q=()=>{var s;b.value=!0,(s=t==null?void 0:t.value.name)!=null&&s.trim()&&(t.value.id?we([t.value.id],t.value.name).then(e=>{p.value[G(t.value.id)]=e,l.add({severity:"success",summary:"Успешно",detail:"Категория обновлена",life:5e3}),f.value=!1,t.value={},D()}).catch(e=>console.error("Error updating categorie:",e)):ke([t.value.name]).then(e=>{console.log(e),p.value.push(...e),l.add({severity:"success",summary:"Успешно",detail:"Категория создана",life:5e3})}).catch(e=>console.error("Error creating categorie:",e)),f.value=!1,t.value={})},H=()=>{L([t.value.id]).then(s=>{p.value=p.value.filter(e=>e.id!==t.value.id),g.value=!1,t.value={},l.add({severity:"success",summary:"Успешно",detail:"Категория удалена",life:5e3})}).catch(s=>console.error("Error delete category:",s))},K=()=>{L(v.value.map(s=>s.id)).then(s=>{p.value=p.value.filter(e=>!v.value.includes(e)),h.value=!1,v.value=null,l.add({severity:"success",summary:"Успешно",detail:"Категории удалены",life:5e3})}).catch(s=>console.error("Error delete Categories:",s))};function D(){V.value=!0,_e().then(s=>{p.value=s,V.value=!1}).catch(s=>console.error("Error fetching categories:",s))}return(s,e)=>{const r=ce,Q=ue,W=pe,X=me,z=fe,Y=ve,Z=ge,P=he,ee=ye,S=be;return y(),_(B,null,[u("div",xe,[u("div",$e,[a(W,{class:"mb-4"},{start:n(()=>[a(r,{label:"Добавить",icon:"pi pi-plus",severity:"success",class:"mr-2",onClick:U}),a(r,{label:"Удалить",icon:"pi pi-trash",severity:"danger",onClick:I,disabled:!i(v)||!i(v).length},null,8,["disabled"])]),end:n(()=>[a(Q,{mode:"basic",accept:"image/*",maxFileSize:1e6,label:"Import",chooseLabel:"Импорт",class:"mr-2 inline-block"}),a(r,{label:"Экспорт",icon:"pi pi-upload",severity:"help",onClick:e[0]||(e[0]=o=>M(o))})]),_:1}),a(ee,{ref_key:"dt",ref:d,value:i(p),selection:i(v),"onUpdate:selection":e[3]||(e[3]=o=>k(v)?v.value=o:null),dataKey:"id",loading:i(V),style:{"max-width":"1500px"},tableStyle:"min-width: 60rem",showGridlines:"",resizableColumns:"",columnResizeMode:"fit",paginator:!0,rows:10,filters:i(E),paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,25,50],currentPageReportTemplate:"Показаны {first} до {last} из {totalRecords}"},{header:n(()=>[u("div",Ee,[u("div",Te,[Ve,a(r,{icon:"pi pi-refresh",rounded:"",raised:"",onClick:D})]),a(Y,{iconPosition:"left"},{default:n(()=>[a(X,null,{default:n(()=>[De]),_:1}),a(z,{modelValue:i(E).global.value,"onUpdate:modelValue":e[1]||(e[1]=o=>i(E).global.value=o),placeholder:"Поиск..."},null,8,["modelValue"])]),_:1})]),a(Z,{modelValue:i(C),"onUpdate:modelValue":[e[2]||(e[2]=o=>k(C)?C.value=o:null),R],options:i(T),optionLabel:"header",display:"chip",placeholder:"Выберите колонки"},null,8,["modelValue","options"])]),empty:n(()=>[w("Категории не найдены")]),default:n(()=>[a(P,{selectionMode:"multiple",style:{width:"3rem"},exportable:!1}),(y(!0),_(B,null,re(i(C),(o,j)=>(y(),ne(P,{sortable:"",field:o.field,header:o.header,key:o.field+"_"+j},{body:n(te=>[w(N(te.data[o.field]),1)]),_:2},1032,["field","header"]))),128)),a(P,{exportable:!1,style:{width:"2rem"}},{body:n(o=>[a(r,{icon:"pi pi-pencil",outlined:"",rounded:"",class:"mr-2",onClick:j=>A(o.data)},null,8,["onClick"]),a(r,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:j=>O(o.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","loading","filters"])])]),a(S,{visible:i(f),"onUpdate:visible":e[5]||(e[5]=o=>k(f)?f.value=o:null),style:{width:"450px"},header:"Категория",modal:!0,class:"p-fluid"},{footer:n(()=>[a(r,{label:"Отмена",icon:"pi pi-times",text:"",onClick:J}),a(r,{label:"Сохранить",icon:"pi pi-check",text:"",onClick:q})]),default:n(()=>[u("div",Pe,[Se,a(z,{class:"mt-2",id:"name",modelValue:i(t).name,"onUpdate:modelValue":e[4]||(e[4]=o=>i(t).name=o),modelModifiers:{trim:!0},required:"",autofocus:"",invalid:i(b)&&!i(t).name},null,8,["modelValue","invalid"]),i(b)&&!i(t).name?(y(),_("small",je,"Название обязательно для заполнения.")):F("",!0)])]),_:1},8,["visible"]),a(S,{visible:i(g),"onUpdate:visible":e[7]||(e[7]=o=>k(g)?g.value=o:null),style:{width:"500px"},header:"Подтверждение",modal:!0},{footer:n(()=>[a(r,{label:"Нет",icon:"pi pi-times",text:"",onClick:e[6]||(e[6]=o=>g.value=!1)}),a(r,{label:"Да",icon:"pi pi-check",text:"",onClick:H})]),default:n(()=>[u("div",Ne,[Fe,i(t)?(y(),_("span",ze,[w("Вы действительно хотите удалить категорию "),u("b",null,N(i(t).name),1),w(),u("span",Be,N(i(t).username)+"?",1)])):F("",!0)])]),_:1},8,["visible"]),a(S,{visible:i(h),"onUpdate:visible":e[9]||(e[9]=o=>k(h)?h.value=o:null),style:{width:"450px"},header:"Подтверждение",modal:!0},{footer:n(()=>[a(r,{label:"Нет",icon:"pi pi-times",text:"",onClick:e[8]||(e[8]=o=>h.value=!1)}),a(r,{label:"Да",icon:"pi pi-check",text:"",onClick:K})]),default:n(()=>[u("div",Le,[Ue,i(t)?(y(),_("span",Ie,"Вы действительно хотите удалить выделенные категории?")):F("",!0)])]),_:1},8,["visible"])],64)}}});export{_t as default};
