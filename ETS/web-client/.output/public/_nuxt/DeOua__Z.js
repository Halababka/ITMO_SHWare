import{A as ae,r as d,o as ie,e as p,f as i,g as a,w as n,h as l,i as U,k as F,F as re,c,j as k,l as ne,m as de,q as me,t as _,n as b,s as ue}from"./Bn8s6ksr.js";import ce from"./CzsHIdTH.js";import pe from"./DREYMDR6.js";import fe from"./DhRU5Jgb.js";import ve from"./wL0GXdHM.js";import _e from"./Cj5F3lRc.js";import be from"./B0mp-r-t.js";import he from"./BBuG_LZR.js";import ge from"./CY5I-LVS.js";import ye from"./v4Gjdufp.js";import ke from"./CJylbKRl.js";import Ve from"./4am-JueE.js";import xe from"./Bsd0B2of.js";import{u as Ue}from"./Ct7qimw6.js";import{f as we,u as Ce,c as $e,d as R}from"./CJ5fVYJb.js";import{e as Le,g as Me}from"./C0BDY4bg.js";import{f as Ee}from"./CcyV51U7.js";import"./BFrbZsHQ.js";import"./DvLZ7Zqz.js";import"./3ww00xj7.js";import"./B2cK24SD.js";import"./BLi23Xor.js";import"./CGQTC3f5.js";import"./B0eqC23B.js";import"./BarrcHik.js";import"./CP2X2kCJ.js";import"./okssMqCN.js";import"./Beh2qRuB.js";import"./CVaRbyVJ.js";import"./cLBxPfJA.js";import"./C9DUTysQ.js";import"./8sW4mJZM.js";import"./Xh5iAUju.js";import"./7fOzFieg.js";import"./BmCDhavC.js";import"./DwA5qEtX.js";import"./BXQHskyo.js";import"./Co_e_0iK.js";import"./B7j0Dt9D.js";import"./CQy9NsTI.js";import"./CaQe4QZp.js";import"./ClO3DDpd.js";const De={class:"main-content"},Pe={class:"card"},Te={class:"flex flex-wrap gap-3 items-center justify-between mb-3"},Ie={class:"flex items-center gap-3"},Ne=i("h4",{class:"m-0 text-xl text-900 font-bold"},"Управление пользователями",-1),Se=i("i",{class:"pi pi-search"},null,-1),Fe={class:"field my-3"},Re=i("label",{for:"username"},"Логин",-1),Be={key:0,class:"p-error"},qe={class:"field my-3"},ze=i("label",{for:"password"},"Пароль",-1),je={key:0,class:"p-error"},Ae={class:"field my-3"},Oe=i("label",{for:"first_name"},"Имя",-1),Ge={key:0,class:"p-error"},Ke={class:"field my-3"},He=i("label",{for:"last_name"},"Фамилия",-1),Je={key:0,class:"p-error"},Qe={class:"field my-3"},We=i("label",{for:"middle_name"},"Отчество",-1),Xe={class:"field my-3"},Ye=i("label",{for:"about"},"Описание",-1),Ze={class:"field my-3"},el=i("label",{for:"email"},"Email",-1),ll={key:0,class:"p-error"},ol={class:"field my-3"},tl=i("label",{for:"role"},"Роль",-1),sl={class:"field my-3"},al=i("label",{for:"groups"},"Группы",-1),il={class:"flex flex-col justify-center flex-wrap"},rl={class:"confirmation-content p-3"},nl=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),dl={key:0},ml={style:{"font-size":"0.90rem"}},ul={class:"confirmation-content p-3"},cl=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),pl={key:0},to={__name:"index",setup(fl){Ue({title:"Администрирование пользователей"});const w=ae(),I=d(),u=d(),f=d(!1),h=d(!1),g=d(!1),o=d({}),v=d(),C=d({global:{value:null,matchMode:re.CONTAINS}}),m=d(!1),$=d([]);d([{label:"ACTIVE",value:"active"},{label:"INACTIVE",value:"inactive"},{label:"BLOCKED",value:"blocked"}]);const L=d([{field:"email",header:"Почта"},{field:"fullname",header:"ФИО"},{field:"username",header:"Логин"},{field:"about",header:"Описание"},{field:"role.name",header:"Роль"},{field:"groups",header:"Группы"}]),V=d(L.value.filter(s=>s.field!=="about")),M=d([]),N=d(!0);ie(()=>{E(),Ee().then(s=>{$.value=s}).catch(s=>console.error("Error fetching roles:",s)),Le().then(s=>{M.value=s,console.log(M.value)}).catch(s=>console.error("Error fetching groups:",s))});const B=()=>{o.value={},m.value=!1,f.value=!0},q=()=>{f.value=!1,m.value=!1},z=()=>{var s;m.value=!0,(s=o==null?void 0:o.value.username)!=null&&s.trim()&&(o.value.id?(delete o.value.fullname,Ce(o.value.id,o.value).then(e=>{u.value[G(o.value.id)]=e,w.add({severity:"success",summary:"Успешно",detail:"Пользователь обновлен",life:3e3}),f.value=!1,o.value={},E()}).catch(e=>console.error("Error updating user:",e))):$e([o.value]).then(e=>{u.value.push(e),w.add({severity:"success",summary:"Успешно",detail:"Пользователь создан",life:3e3})}).catch(e=>console.error("Error creating user:",e)),f.value=!1,o.value={})},j=s=>{o.value={...s},f.value=!0,console.log(o)},A=s=>{o.value=s,h.value=!0},O=()=>{R([o.value.id]).then(s=>{u.value=u.value.filter(e=>e.id!==o.value.id),h.value=!1,o.value={},w.add({severity:"success",summary:"Успешно",detail:"Пользователь удален",life:3e3})}).catch(s=>console.error("Error delete user:",s))},G=s=>{let e=-1;for(let r=0;r<u.value.length;r++)if(u.value[r].id===s){e=r;break}return e},K=()=>{I.value.exportCSV()},H=()=>{g.value=!0},J=()=>{R(v.value.map(s=>s.id)).then(s=>{u.value=u.value.filter(e=>!v.value.includes(e)),g.value=!1,v.value=null,w.add({severity:"success",summary:"Успешно",detail:"Пользователи удалены",life:3e3})}).catch(s=>console.error("Error delete users:",s))},Q=s=>{V.value=L.value.filter(e=>s.includes(e))};function E(){we().then(s=>{u.value=s.map(e=>({...e,fullname:`${e.last_name} ${e.first_name} ${e.middle_name}`})),N.value=!1}).catch(s=>console.error("Error fetching users:",s))}const W=s=>{const e=$.value.find(r=>r.name===s);e&&(o.value.role=e),console.log(o.value)};return(s,e)=>{const r=ue,X=ce,Y=pe,Z=fe,y=ve,ee=_e,S=be,D=he,le=ge,oe=ye,te=ke,se=Ve,P=xe;return c(),p(F,null,[i("div",De,[i("div",Pe,[a(Y,{class:"mb-4"},{start:n(()=>[a(r,{label:"Добавить",icon:"pi pi-plus",severity:"success",class:"mr-2",onClick:B}),a(r,{label:"Удалить",icon:"pi pi-trash",severity:"danger",onClick:H,disabled:!l(v)||!l(v).length},null,8,["disabled"])]),end:n(()=>[a(X,{mode:"basic",accept:"image/*",maxFileSize:1e6,label:"Import",chooseLabel:"Импорт",class:"mr-2 inline-block"}),a(r,{label:"Экспорт",icon:"pi pi-upload",severity:"help",onClick:e[0]||(e[0]=t=>K(t))})]),_:1}),a(le,{ref_key:"dt",ref:I,value:l(u),selection:l(v),"onUpdate:selection":e[3]||(e[3]=t=>U(v)?v.value=t:null),dataKey:"id",loading:l(N),style:{"max-width":"1500px"},tableStyle:"min-width: 60rem",showGridlines:"",resizableColumns:"",columnResizeMode:"fit",paginator:!0,rows:10,filters:l(C),paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,25,50],currentPageReportTemplate:"Показаны {first} до {last} из {totalRecords}"},{header:n(()=>[i("div",Te,[i("div",Ie,[Ne,a(r,{icon:"pi pi-refresh",rounded:"",raised:"",onClick:E})]),a(ee,{iconPosition:"left"},{default:n(()=>[a(Z,null,{default:n(()=>[Se]),_:1}),a(y,{modelValue:l(C).global.value,"onUpdate:modelValue":e[1]||(e[1]=t=>l(C).global.value=t),placeholder:"Поиск..."},null,8,["modelValue"])]),_:1})]),a(S,{modelValue:l(V),"onUpdate:modelValue":[e[2]||(e[2]=t=>U(V)?V.value=t:null),Q],options:l(L),optionLabel:"header",display:"chip",placeholder:"Выберите колонки"},null,8,["modelValue","options"])]),empty:n(()=>[k(" Пользователи не найдены")]),default:n(()=>[a(D,{selectionMode:"multiple",style:{width:"3rem"},exportable:!1}),(c(!0),p(F,null,ne(l(V),(t,T)=>(c(),de(D,{sortable:"",field:t.field,header:t.header,key:t.field+"_"+T},me({_:2},[t.field!=="groups"&&t.field!=="role.name"?{name:"body",fn:n(x=>[k(_(x.data[t.field]),1)]),key:"0"}:t.field==="role.name"?{name:"body",fn:n(x=>[k(_(x.data.role.name),1)]),key:"1"}:t.field==="groups"?{name:"body",fn:n(x=>[k(_(l(Me)(x.data.groups)),1)]),key:"2"}:void 0]),1032,["field","header"]))),128)),a(D,{exportable:!1,style:{"min-width":"8rem"}},{body:n(t=>[a(r,{icon:"pi pi-pencil",outlined:"",rounded:"",class:"mr-2",onClick:T=>j(t.data)},null,8,["onClick"]),a(r,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:T=>A(t.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","loading","filters"])])]),a(P,{visible:l(f),"onUpdate:visible":e[12]||(e[12]=t=>U(f)?f.value=t:null),style:{width:"450px"},header:"Сведения о пользователе",modal:!0,class:"p-fluid"},{footer:n(()=>[a(r,{label:"Отмена",icon:"pi pi-times",text:"",onClick:q}),a(r,{label:"Сохранить",icon:"pi pi-check",text:"",onClick:z})]),default:n(()=>[i("div",Fe,[Re,a(y,{class:"mt-2",id:"username",modelValue:l(o).username,"onUpdate:modelValue":e[4]||(e[4]=t=>l(o).username=t),modelModifiers:{trim:!0},required:"",autofocus:"",invalid:l(m)&&!l(o).username},null,8,["modelValue","invalid"]),l(m)&&!l(o).username?(c(),p("small",Be,"Имя пользователя обязательно для заполнения.")):b("",!0)]),i("div",qe,[ze,a(oe,{class:"mt-2",id:"password",promptLabel:"Введите пароль",weakLabel:"Слабый",mediumLabel:"Средний",strongLabel:"Сильный",modelValue:l(o).password,"onUpdate:modelValue":e[5]||(e[5]=t=>l(o).password=t),modelModifiers:{trim:!0},toggleMask:"",required:"",invalid:l(m)&&!l(o).password},null,8,["modelValue","invalid"]),l(m)&&!l(o).password?(c(),p("small",je,"Пароль обязателен для заполнения.")):b("",!0)]),i("div",Ae,[Oe,a(y,{class:"mt-2",id:"first_name",modelValue:l(o).first_name,"onUpdate:modelValue":e[6]||(e[6]=t=>l(o).first_name=t),modelModifiers:{trim:!0},required:"",invalid:l(m)&&!l(o).first_name},null,8,["modelValue","invalid"]),l(m)&&!l(o).first_name?(c(),p("small",Ge,"Имя обязательно для заполнения.")):b("",!0)]),i("div",Ke,[He,a(y,{class:"mt-2",id:"last_name",modelValue:l(o).last_name,"onUpdate:modelValue":e[7]||(e[7]=t=>l(o).last_name=t),modelModifiers:{trim:!0},required:"",invalid:l(m)&&!l(o).last_name},null,8,["modelValue","invalid"]),l(m)&&!l(o).last_name?(c(),p("small",Je,"Фамилия обязательна для заполнения.")):b("",!0)]),i("div",Qe,[We,a(y,{class:"mt-2",id:"middle_name",modelValue:l(o).middle_name,"onUpdate:modelValue":e[8]||(e[8]=t=>l(o).middle_name=t),modelModifiers:{trim:!0}},null,8,["modelValue"])]),i("div",Xe,[Ye,a(te,{class:"mt-2",id:"about",modelValue:l(o).about,"onUpdate:modelValue":e[9]||(e[9]=t=>l(o).about=t),modelModifiers:{trim:!0}},null,8,["modelValue"])]),i("div",Ze,[el,a(y,{class:"mt-2",id:"email",modelValue:l(o).email,"onUpdate:modelValue":e[10]||(e[10]=t=>l(o).email=t),modelModifiers:{trim:!0},required:"",invalid:l(m)&&!l(o).email},null,8,["modelValue","invalid"]),l(m)&&!l(o).email?(c(),p("small",ll,"Email обязателен для заполнения.")):b("",!0)]),i("div",ol,[tl,a(se,{class:"mt-2",id:"role",modelValue:l(o).role?l(o).role.name:"","onUpdate:modelValue":W,options:l($).map(t=>t.name),placeholder:"Выберите роль"},null,8,["modelValue","options"])]),i("div",sl,[al,a(S,{class:"mt-2",modelValue:l(o).groups,"onUpdate:modelValue":e[11]||(e[11]=t=>l(o).groups=t),options:l(M),optionLabel:"abbreviation",filter:!0,filterFields:["full_name","abbreviation"],display:"chip",placeholder:"Выберите группы"},{option:n(t=>[i("div",il,[i("div",null,_(t.option.full_name),1),i("div",null,_(t.option.abbreviation),1)])]),_:1},8,["modelValue","options"])])]),_:1},8,["visible"]),a(P,{visible:l(h),"onUpdate:visible":e[14]||(e[14]=t=>U(h)?h.value=t:null),style:{width:"500px"},header:"Подтверждение",modal:!0},{footer:n(()=>[a(r,{label:"Нет",icon:"pi pi-times",text:"",onClick:e[13]||(e[13]=t=>h.value=!1)}),a(r,{label:"Да",icon:"pi pi-check",text:"",onClick:O})]),default:n(()=>[i("div",rl,[nl,l(o)?(c(),p("span",dl,[k("Вы действительно хотите удалить пользователя "),i("b",null,_(l(o).fullname),1),k(),i("span",ml,_(l(o).username)+"?",1)])):b("",!0)])]),_:1},8,["visible"]),a(P,{visible:l(g),"onUpdate:visible":e[16]||(e[16]=t=>U(g)?g.value=t:null),style:{width:"450px"},header:"Подтверждение",modal:!0},{footer:n(()=>[a(r,{label:"Нет",icon:"pi pi-times",text:"",onClick:e[15]||(e[15]=t=>g.value=!1)}),a(r,{label:"Да",icon:"pi pi-check",text:"",onClick:J})]),default:n(()=>[i("div",ul,[cl,l(o)?(c(),p("span",pl,"Вы действительно хотите удалить выделенных пользователей?")):b("",!0)])]),_:1},8,["visible"])],64)}}};export{to as default};
