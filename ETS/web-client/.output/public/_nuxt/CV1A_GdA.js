import{_ as ye,b as xe,r as d,o as ke,e as g,f as r,g as a,w as n,h as t,i as b,k as q,F as K,c,t as m,m as H,j as C,n as I,l as ae,q as we,v as Ce,x as Ve,s as Pe,p as Ue}from"./Bn8s6ksr.js";import Ge from"./DREYMDR6.js";import Re from"./DhRU5Jgb.js";import $e from"./wL0GXdHM.js";import Le from"./Cj5F3lRc.js";import Te from"./B0mp-r-t.js";import Ie from"./BBuG_LZR.js";import De from"./CY5I-LVS.js";import Ne from"./4am-JueE.js";import Ee from"./Bsd0B2of.js";import{u as Se}from"./Ct7qimw6.js";import{f as Me,g as Fe,u as Ae,c as Be,d as oe,a as Oe,b as ze}from"./C0BDY4bg.js";import{f as je}from"./CJ5fVYJb.js";import{a as qe}from"./ClO3DDpd.js";import"./BarrcHik.js";import"./B2cK24SD.js";import"./CP2X2kCJ.js";import"./okssMqCN.js";import"./DvLZ7Zqz.js";import"./CGQTC3f5.js";import"./Beh2qRuB.js";import"./CVaRbyVJ.js";import"./cLBxPfJA.js";import"./C9DUTysQ.js";import"./8sW4mJZM.js";import"./Xh5iAUju.js";import"./7fOzFieg.js";import"./BmCDhavC.js";import"./DwA5qEtX.js";import"./BXQHskyo.js";import"./Co_e_0iK.js";import"./B7j0Dt9D.js";import"./BFrbZsHQ.js";import"./CQy9NsTI.js";const y=D=>(Ce("data-v-9ccedb74"),D=D(),Ve(),D),Ke={class:"main-content flex-col"},He={class:"card"},We={class:"flex flex-wrap gap-3 items-center justify-between mb-3"},Je={class:"flex items-center gap-3"},Qe=y(()=>r("h4",{class:"m-0 text-xl text-900 font-bold"},"Управление группами",-1)),Xe=y(()=>r("i",{class:"pi pi-search"},null,-1)),Ye={class:"m-0 mb-2"},Ze=y(()=>r("h2",null,"Управление составом групп",-1)),el={class:"card"},ll={key:0,class:"flex align-items-center"},tl={key:1},al={class:"flex flex-col justify-center flex-wrap"},ol={class:"flex flex-wrap gap-3 items-center justify-between mb-3"},il={class:"flex items-center gap-3"},sl=y(()=>r("h4",{class:"m-0 text-xl text-900 font-bold"},"Пользователи",-1)),nl=y(()=>r("i",{class:"pi pi-search"},null,-1)),rl={class:"field my-3"},dl=y(()=>r("label",{for:"full_name"},"Полное название",-1)),ul={key:0,class:"p-error"},pl={class:"field my-3"},cl=y(()=>r("label",{for:"abbreviation"},"Аббревиатура",-1)),ml={key:0,class:"p-error"},fl={class:"confirmation-content p-3"},vl=y(()=>r("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),bl={key:0},_l={class:"confirmation-content p-3"},hl=y(()=>r("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),gl={key:0},yl={__name:"index",setup(D){Se({title:"Администрирование групп"}),xe();const P=d(!0),{$toast:U}=Ue(),S=d(),p=d(),x=d(!1),G=d(!1),R=d(!1),i=d({}),k=d(),M=d({global:{value:null,matchMode:K.CONTAINS}}),F=d({global:{value:null,matchMode:K.CONTAINS}}),A=d({fullname:{value:null,matchMode:K.CONTAINS}}),V=d(!1);d([]),d([{label:"ACTIVE",value:"active"},{label:"INACTIVE",value:"inactive"},{label:"BLOCKED",value:"blocked"}]);const B=d([{field:"full_name",header:"Наименование"},{field:"abbreviation",header:"Аббревиатура"},{field:"created_at",header:"Дата создания"},{field:"updated_at",header:"Дата обновления"}]),$=d(B.value.filter(o=>o.field!=="updated_at")),O=d({}),w=d(),W=d(),J=d([{field:"email",header:"Почта"},{field:"fullname",header:"ФИО"},{field:"username",header:"Логин"},{field:"about",header:"Описание"},{field:"role.name",header:"Роль"},{field:"groups",header:"Группы"}]),N=d(J.value.filter(o=>o.field!=="about")),ie=()=>{i.value={},V.value=!1,x.value=!0},se=()=>{x.value=!1,V.value=!1},ne=()=>{var o;V.value=!0,(o=i==null?void 0:i.value.full_name)!=null&&o.trim()&&(i.value.id?(console.log(i.value.id,i.value),Ae(i.value.id,i.value).then(e=>{p.value[pe(i.value.id)]=e,U.add({severity:"success",summary:"Успешно",detail:"Группа обновлена",life:5e3}),x.value=!1,i.value={},L()}).catch(e=>console.error("Error updating group:",e))):Be(i.value).then(e=>{p.value.push(e),U.add({severity:"success",summary:"Успешно",detail:"Группа создана",life:5e3})}).catch(e=>console.error("Error creating group:",e)),x.value=!1,i.value={})},re=o=>{i.value={...o},x.value=!0,console.log(i)},de=o=>{i.value=o,G.value=!0},ue=()=>{oe([i.value.id]).then(o=>{p.value=p.value.filter(e=>e.id!==i.value.id),G.value=!1,i.value={},U.add({severity:"success",summary:"Успешно",detail:"Группа удалена",life:5e3})}).catch(o=>console.error("Error delete group:",o))},Q=(o,e)=>{Oe(o,e).then(()=>{L(),U.add({severity:"success",summary:"Успешно",detail:"Пользователь удален из группы",life:5e3})}).catch(s=>console.error("Ошибка удаления пользователя из группы:",s)).finally(E)},X=(o,e)=>{ze(o,e).then(()=>{L(),U.add({severity:"success",summary:"Успешно",detail:"Пользователь добавлен в группу",life:5e3})}).catch(s=>console.error("Ошибка добавления пользователя в группу:",s)).finally(E)},pe=o=>{let e=-1;for(let s=0;s<p.value.length;s++)if(p.value[s].id===o){e=s;break}return e},ce=()=>{S.value.exportCSV()},me=()=>{R.value=!0},fe=()=>{console.log(w.value),X(i.value.id,w.value.map(o=>o.id)),w.value=null},ve=()=>{oe(k.value.map(o=>o.id)).then(o=>{p.value=p.value.filter(e=>!k.value.includes(e)),R.value=!1,k.value=null,U.add({severity:"success",summary:"Успешно",detail:"Пользователи удалены",life:5e3})}).catch(o=>console.error("Error delete groups:",o))},be=(o,e)=>o?!e.some(_=>{var T;return(_==null?void 0:_.id)===o||((T=_==null?void 0:_.children)==null?void 0:T.some(h=>(h==null?void 0:h.id)===o))}):!0,Y=o=>{$.value=B.value.filter(e=>o.includes(e))},_e=o=>{},he=o=>{};function L(){Me().then(o=>{o.forEach(e=>{e.users&&e.users.forEach(s=>{s.fullname=`${s.last_name} ${s.first_name} ${s.middle_name}`,s.group_id=e.id})}),p.value=o.map(e=>({...e})),p.value=qe(p.value),console.log(p.value),P.value=!1}).catch(o=>console.error("Error fetching groups:",o))}function E(){P.value=!0,je().then(o=>{W.value=o.map(e=>({...e,fullname:`${e.last_name} ${e.first_name} ${e.middle_name}`})),P.value=!1}).catch(o=>console.error("Error fetching users:",o)).finally(()=>{P.value=!1})}return ke(()=>{L(),E()}),(o,e)=>{const s=Pe,_=Ge,T=Re,h=$e,Z=Le,ee=Te,f=Ie,z=De,ge=Ne,j=Ee;return c(),g(q,null,[r("div",Ke,[r("div",He,[a(_,{class:"mb-4"},{start:n(()=>[a(s,{label:"Добавить",icon:"pi pi-plus",severity:"success",class:"mr-2",onClick:ie}),a(s,{label:"Удалить",icon:"pi pi-trash",severity:"danger",onClick:me,disabled:!t(k)||!t(k).length},null,8,["disabled"])]),end:n(()=>[a(s,{label:"Экспорт",icon:"pi pi-upload",severity:"help",onClick:e[0]||(e[0]=l=>ce(l))})]),_:1}),a(z,{ref_key:"dt",ref:S,expandedRows:t(O),"onUpdate:expandedRows":e[4]||(e[4]=l=>b(O)?O.value=l:null),value:t(p),selection:t(k),"onUpdate:selection":e[5]||(e[5]=l=>b(k)?k.value=l:null),dataKey:"id",style:{"max-width":"1500px"},loading:t(P),onRowExpand:_e,onRowCollapse:he,showGridlines:"",resizableColumns:"",columnResizeMode:"fit",paginator:!0,rows:10,filters:t(M),paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,25,50],currentPageReportTemplate:"Показаны {first} до {last} из {totalRecords}"},{header:n(()=>[r("div",We,[r("div",Je,[Qe,a(s,{icon:"pi pi-refresh",rounded:"",raised:"",onClick:L})]),a(Z,{iconPosition:"left"},{default:n(()=>[a(T,null,{default:n(()=>[Xe]),_:1}),a(h,{modelValue:t(M).global.value,"onUpdate:modelValue":e[1]||(e[1]=l=>t(M).global.value=l),placeholder:"Поиск..."},null,8,["modelValue"])]),_:1})]),a(ee,{modelValue:t($),"onUpdate:modelValue":[e[2]||(e[2]=l=>b($)?$.value=l:null),Y],options:t(B),optionLabel:"header",display:"chip",placeholder:"Выберите колонки"},null,8,["modelValue","options"])]),expansion:n(l=>{var v;return[r("div",null,[r("h4",Ye,"Участники группы "+m(l.data.abbreviation),1),((v=l.data.users)==null?void 0:v.length)!==0?(c(),H(z,{key:0,filters:t(A),"onUpdate:filters":e[3]||(e[3]=u=>b(A)?A.value=u:null),filterDisplay:"row",globalFilterFields:["fullname"],value:l.data.users,paginator:!0,rows:20,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[20,40,80],currentPageReportTemplate:"Показаны {first} до {last} из {totalRecords}"},{default:n(()=>[a(f,{field:"fullname",header:"ФИО"},{body:n(u=>[C(m(u.data.fullname),1)]),filter:n(({filterModel:u,filterCallback:le})=>[a(h,{modelValue:u.value,"onUpdate:modelValue":te=>u.value=te,type:"text",onInput:te=>le(),class:"p-column-filter",placeholder:"Поиск по имени"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),a(f,{field:"email",header:"Почта"},{body:n(u=>[C(m(u.data.email),1)]),_:2},1024),a(f,{field:"username",header:"Логин"},{body:n(u=>[C(m(u.data.username),1)]),_:2},1024),a(f,{exportable:!1,style:{width:"2rem"}},{body:n(u=>[a(s,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:le=>Q(u.data.group_id,[u.data.id])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["filters","value"])):I("",!0)])]}),default:n(()=>[a(f,{expander:"",style:{width:"3rem"}}),a(f,{selectionMode:"multiple",style:{width:"3rem"},exportable:!1}),(c(!0),g(q,null,ae(t($),(l,v)=>(c(),H(f,{sortable:"",field:l.field,header:l.header,key:l.field+"_"+v},null,8,["field","header"]))),128)),a(f,{exportable:!1,style:{"min-width":"8rem"}},{body:n(l=>[a(s,{icon:"pi pi-pencil",outlined:"",rounded:"",class:"mr-2",onClick:v=>re(l.data)},null,8,["onClick"]),a(s,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:v=>de(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["expandedRows","value","selection","loading","filters"])]),r("div",null,[Ze,r("div",el,[a(_,{class:"mb-4"},{start:n(()=>[a(s,{label:"Добавить",icon:"pi pi-plus",severity:"success",onClick:fe,disabled:!t(w)||!t(w).length||!t(i).id},null,8,["disabled"])]),end:n(()=>[a(ge,{modelValue:t(i),"onUpdate:modelValue":e[6]||(e[6]=l=>b(i)?i.value=l:null),options:t(p),filter:"",optionLabel:"abbreviation",placeholder:"Выберите группу",class:"w-full md:w-14rem"},{value:n(l=>[l.value.abbreviation?(c(),g("div",ll,[r("div",null,m(l.value.abbreviation),1)])):(c(),g("span",tl,m(l.placeholder),1))]),option:n(l=>[r("div",al,[r("div",null,m(l.option.full_name),1),r("div",null,m(l.option.abbreviation),1)])]),_:1},8,["modelValue","options"])]),_:1}),a(z,{ref_key:"dt",ref:S,value:t(W),selection:t(w),"onUpdate:selection":e[9]||(e[9]=l=>b(w)?w.value=l:null),dataKey:"id",loading:t(P),style:{"max-width":"1500px"},tableStyle:"min-width: 60rem",showGridlines:"",resizableColumns:"",columnResizeMode:"fit",paginator:!0,rows:10,filters:t(F),paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,25,50],currentPageReportTemplate:"Показаны {first} до {last} из {totalRecords}"},{header:n(()=>[r("div",ol,[r("div",il,[sl,a(s,{icon:"pi pi-refresh",rounded:"",raised:"",onClick:E})]),a(Z,{iconPosition:"left"},{default:n(()=>[a(T,null,{default:n(()=>[nl]),_:1}),a(h,{modelValue:t(F).global.value,"onUpdate:modelValue":e[7]||(e[7]=l=>t(F).global.value=l),placeholder:"Поиск..."},null,8,["modelValue"])]),_:1})]),a(ee,{modelValue:t(N),"onUpdate:modelValue":[e[8]||(e[8]=l=>b(N)?N.value=l:null),Y],options:t(J),optionLabel:"header",display:"chip",placeholder:"Выберите колонки"},null,8,["modelValue","options"])]),empty:n(()=>[C(" Пользователи не найдены")]),default:n(()=>[a(f,{selectionMode:"multiple",style:{width:"3rem"},exportable:!1}),(c(!0),g(q,null,ae(t(N),(l,v)=>(c(),H(f,{sortable:"",field:l.field,header:l.header,key:l.field+"_"+v},we({_:2},[l.field!=="groups"&&l.field!=="role.name"?{name:"body",fn:n(u=>[C(m(u.data[l.field]),1)]),key:"0"}:l.field==="role.name"?{name:"body",fn:n(u=>[C(m(u.data.role.name),1)]),key:"1"}:l.field==="groups"?{name:"body",fn:n(u=>[C(m(t(Fe)(u.data.groups)),1)]),key:"2"}:void 0]),1032,["field","header"]))),128)),a(f,{exportable:!1,style:{"min-width":"8rem"}},{body:n(l=>[a(s,{icon:"pi pi-plus",outlined:"",rounded:"",class:"mr-2",severity:"success",disabled:!t(i).id,onClick:v=>X(t(i).id,[l.data.id])},null,8,["disabled","onClick"]),a(s,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",disabled:be(t(i).id,l.data.groups),onClick:v=>Q(t(i).id,[l.data.id])},null,8,["disabled","onClick"])]),_:1})]),_:1},8,["value","selection","loading","filters"])])])]),a(j,{visible:t(x),"onUpdate:visible":e[12]||(e[12]=l=>b(x)?x.value=l:null),style:{width:"450px"},header:"Сведения о группе",modal:!0,class:"p-fluid"},{footer:n(()=>[a(s,{label:"Отмена",icon:"pi pi-times",text:"",onClick:se}),a(s,{label:"Сохранить",icon:"pi pi-check",text:"",onClick:ne})]),default:n(()=>[r("div",rl,[dl,a(h,{class:"mt-2",id:"full_name",modelValue:t(i).full_name,"onUpdate:modelValue":e[10]||(e[10]=l=>t(i).full_name=l),modelModifiers:{trim:!0},required:"",autofocus:"",invalid:t(V)&&!t(i).full_name},null,8,["modelValue","invalid"]),t(V)&&!t(i).full_name?(c(),g("small",ul,"Полное название обязательно для заполнения.")):I("",!0)]),r("div",pl,[cl,a(h,{class:"mt-2",id:"abbreviation",modelValue:t(i).abbreviation,"onUpdate:modelValue":e[11]||(e[11]=l=>t(i).abbreviation=l),modelModifiers:{trim:!0},required:"",invalid:t(V)&&!t(i).abbreviation},null,8,["modelValue","invalid"]),t(V)&&!t(i).abbreviation?(c(),g("small",ml,"Аббревиатура обязательна для заполнения.")):I("",!0)])]),_:1},8,["visible"]),a(j,{visible:t(G),"onUpdate:visible":e[14]||(e[14]=l=>b(G)?G.value=l:null),style:{width:"500px"},header:"Подтверждение",modal:!0},{footer:n(()=>[a(s,{label:"Нет",icon:"pi pi-times",text:"",onClick:e[13]||(e[13]=l=>G.value=!1)}),a(s,{label:"Да",icon:"pi pi-check",text:"",onClick:ue})]),default:n(()=>[r("div",fl,[vl,t(i)?(c(),g("span",bl,[C("Вы действительно хотите удалить группу "),r("b",null,m(t(i).full_name),1)])):I("",!0)])]),_:1},8,["visible"]),a(j,{visible:t(R),"onUpdate:visible":e[16]||(e[16]=l=>b(R)?R.value=l:null),style:{width:"450px"},header:"Подтверждение",modal:!0},{footer:n(()=>[a(s,{label:"Нет",icon:"pi pi-times",text:"",onClick:e[15]||(e[15]=l=>R.value=!1)}),a(s,{label:"Да",icon:"pi pi-check",text:"",onClick:ve})]),default:n(()=>[r("div",_l,[hl,t(i)?(c(),g("span",gl,"Вы действительно хотите удалить выделенные группы?")):I("",!0)])]),_:1},8,["visible"])],64)}}},lt=ye(yl,[["__scopeId","data-v-9ccedb74"]]);export{lt as default};
