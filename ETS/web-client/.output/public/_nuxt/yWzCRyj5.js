import{d as U,y as B,b as V,u as T,r as n,z,c as j,e as O,f as e,h as a,C as q,D as b,E as g,g as c,w as f,j as P,R as E,t as J,k as M,a as R,v as F,x as H,_ as G}from"./Bn8s6ksr.js";import{u as K}from"./Ct7qimw6.js";import{A as I}from"./CHEYgbY9.js";import{A as C}from"./CmGhXXe7.js";import{u as L}from"./7jZtv5KM.js";import"./BXRJdK4x.js";const m=_=>(F("data-v-e8b4bf8b"),_=_(),H(),_),Q={class:"main-content"},W={class:"personalData"},X={class:"photoName"},Y={class:"photo"},Z=["src"],ee={class:"input-group"},te={class:"input-form"},oe=m(()=>e("label",{for:"file"},"Имя",-1)),ae={class:"input-form"},se=m(()=>e("label",{for:"first_name"},"Имя",-1)),le={class:"input-form"},ne=m(()=>e("label",{for:"last_name"},"Фамилия",-1)),ie={class:"modal-content"},re={class:"modal-content"},de={class:"change-pwd"},ue={class:"input-group"},pe={class:"input-form"},ce=m(()=>e("label",{for:"last_name"},"Старый пароль",-1)),fe={class:"input-form"},me=m(()=>e("label",{for:"last_name"},"Новый пароль",-1)),_e=U({__name:"odProfile",async setup(_){let v,S;K({title:"Профиль"});const x=([v,S]=B(()=>L()),v=await v,S(),v).value,A=V(),y=T("token"),k=n({first_name:""});z(()=>{x.pending||(k.value.first_name=x.userData.first_name)});const i={state:n("boy1.png"),bufer:n(""),setImage:s=>{i.bufer.value=s},saveImage:()=>{i.bufer.value!=""&&(i.state.value=i.bufer.value,i.bufer.value="")}},d=n(!1),u=n(!1);let r=n(!1),h=n("");const w=R();let l=n({first_name:"",last_name:"",group_name:"",oldPwd:"",newPwd:"",profile_photo:""}),p;function N(){fetch(`${w.public.apiBase}/users/${localStorage.getItem("id")}/password`,{method:"PUT",headers:{Authorization:y.value},body:JSON.stringify({old_password:l.value.oldPwd,new_password:l.value.newPwd})}).then(s=>{switch(s.status){case 401:localStorage.clear(),A.push({path:"/home"});break;case 200:r.value=!1,l.value.oldPwd="",l.value.newPwd="";return}return s.json()}).then(s=>{if(s)switch(s.error){case"old password mysteriously missing":r.value=!0,h.value="Не введен старый пароль";break;case"new password too short":r.value=!0,h.value="Новый пароль короткий";break;case"old password not match":r.value=!0,h.value="Неверный старый пароль";break}}).catch(s=>{console.error("Невозможно отправить запрос",s)})}function D(){p===void 0&&(p=l.value.profile_photo),fetch(`${w.public.apiBase}/users/${localStorage.getItem("id")}`,{method:"PUT",headers:{Authorization:y.value},body:JSON.stringify({first_name:l.value.first_name,last_name:JSON.stringify({lastName:l.value.last_name,profilePhoto:p})})}).then(s=>{switch(s.status){case 401:localStorage.removeItem("token"),A.push({path:"/home"});break}return s.json()}).then(s=>{r.value=!1,refresh()}).catch(s=>{console.error("Невозможно отправить запрос",s)})}function $(){const s=document.querySelector('input[type="file"]');let t=new FormData;t.append("uploadedfile",s.files[0]),fetch(`${w.public.apiBase}/uploads`,{method:"POST",headers:{Authorization:y.value},body:t}).then(o=>{switch(o.status){case 200:alert("Файл загружен успешно");break;case 500:alert("Файл не выбран");break}return o.json()}).then(o=>{p=o.url,l.value.profile_photo=p}).catch(o=>{console.error("Невозможно отправить запрос",o)})}return(s,t)=>(j(),O(M,null,[e("div",Q,[e("div",W,[e("div",X,[e("div",Y,[e("img",{src:[a(l).profile_photo?`${a(w).public.domainName+a(l).profile_photo}`:"assets/imgs/no_course_photo.png"],onClick:t[0]||(t[0]=o=>d.value=!a(d)),alt:"Фото профиля",draggable:"false"},null,8,Z)])]),e("form",{onSubmit:t[5]||(t[5]=q(o=>D(),["prevent"])),class:"form"},[e("div",ee,[e("div",te,[oe,e("input",{type:"file",name:"file",id:"file",onChange:t[1]||(t[1]=o=>$())},null,32)]),e("div",ae,[se,b(e("input",{id:"first_name","onUpdate:modelValue":t[2]||(t[2]=o=>a(k).first_name=o),type:"text",placeholder:"Введите имя",required:""},null,512),[[g,a(k).first_name]])]),e("div",le,[ne,b(e("input",{id:"last_name","onUpdate:modelValue":t[3]||(t[3]=o=>a(l).last_name=o),type:"text",placeholder:"Введите фамилию",required:""},null,512),[[g,a(l).last_name]])]),e("a",{class:"link",onClick:t[4]||(t[4]=o=>u.value=!a(u))},"Сменить пароль")]),c(C,null,{default:f(()=>[P("Сохранить")]),_:1})],32)])]),c(I,{onClose:t[7]||(t[7]=o=>d.value=!a(d)),modalActive:a(d),title:"Изображения профиля"},{default:f(()=>[e("div",ie,[e("input",{type:"file",name:"file",onChange:t[6]||(t[6]=o=>$())},null,32),c(C,{onClick:i.saveImage},{default:f(()=>[P("Сохранить")]),_:1},8,["onClick"])])]),_:1},8,["modalActive"]),c(I,{onClose:t[10]||(t[10]=o=>u.value=!a(u)),modalActive:a(u),title:"Смена пароля"},{default:f(()=>[e("div",re,[e("div",de,[e("div",{class:"error-block",style:E([a(r)?{opacity:1,padding:"16px"}:{opacity:0}])},[e("span",null,J(a(h)),1)],4),e("div",ue,[e("div",pe,[ce,b(e("input",{id:"password","onUpdate:modelValue":t[8]||(t[8]=o=>a(l).oldPwd=o),type:"text",placeholder:"Введите старый пароль"},null,512),[[g,a(l).oldPwd]])]),e("div",fe,[me,b(e("input",{id:"password","onUpdate:modelValue":t[9]||(t[9]=o=>a(l).newPwd=o),type:"text",placeholder:"Введите новый пароль"},null,512),[[g,a(l).newPwd]]),c(C,{onClick:N},{default:f(()=>[P("Сменить пароль")]),_:1})])])])])]),_:1},8,["modalActive"])],64))}}),ke=G(_e,[["__scopeId","data-v-e8b4bf8b"]]);export{ke as default};
