import ne from"./DM0cgjgH.js";import{_ as se,u as I,r as p,z as ae,e as v,g as a,w as b,h as t,f as s,D as Q,E as D,i as x,k as S,a as re,c as d,l as q,m as P,s as C,n as U,j as W,t as L,v as ie,x as ue,bu as ce,H as de,p as pe}from"./Bn8s6ksr.js";import me from"./4am-JueE.js";import he from"./wL0GXdHM.js";import ve from"./B7j0Dt9D.js";import fe from"./BarrcHik.js";import{u as ye}from"./Ct7qimw6.js";import{u as O}from"./BXRJdK4x.js";import{_ as _e}from"./CWZifVmV.js";import be from"./CY5I-LVS.js";import k from"./BBuG_LZR.js";import{A as we}from"./CmGhXXe7.js";import{A as Ee}from"./CHEYgbY9.js";import"./DwA5qEtX.js";import"./CP2X2kCJ.js";import"./Beh2qRuB.js";import"./CVaRbyVJ.js";import"./B2cK24SD.js";import"./okssMqCN.js";import"./DvLZ7Zqz.js";import"./cLBxPfJA.js";import"./DW4Dnba0.js";import"./C9DUTysQ.js";import"./8sW4mJZM.js";import"./Xh5iAUju.js";import"./7fOzFieg.js";import"./BmCDhavC.js";import"./BXQHskyo.js";import"./Co_e_0iK.js";import"./BFrbZsHQ.js";import"./CQy9NsTI.js";const g=T=>(ie("data-v-e0ef7802"),T=T(),ue(),T),xe={class:"modal-content flex flex-col gap-2"},ke=g(()=>s("label",null,"Текст вопроса:",-1)),ge=g(()=>s("p",null,"Выбранная тема:",-1)),Te=g(()=>s("label",null,"Сложность:",-1)),Ae={class:"level"},Ve={class:"questionType"},Ne=g(()=>s("p",null,"Тип вопроса",-1)),Se={key:0},Ce={key:1},Re={key:2,class:"one-answers"},$e={class:"answer flex gap-2 flex-col"},je={class:"answer-row flex gap-1"},Ie={class:"flex align-items-center mb-5"},qe=["for"],Pe={key:3,class:"many-answers"},Ue={class:"answer flex gap-2 flex-col"},We={class:"answer-row flex gap-1"},Le={class:"flex align-items-center mb-5"},Be=["for"],Xe={key:4,class:"text-answer"},Me={class:"main-content white-box"},Qe={class:"header flex w-full justify-between"},De=g(()=>s("h2",null,"Вопросы",-1)),Oe={class:"flex items-center"},ze={class:"btn-panel flex w-full gap-2"},Fe={class:"card flex justify-content-center"},Ge={__name:"index",setup(T){ye({title:"Тесты"});const{$toast:z}=pe(),F=I("token"),A=re(),V=p(""),R=p(""),w=p(!1),G=p([1,2,3,4,5,6,7,8,9]),m=p(0),f=p(null),$=p(null),j=p(0),B=p("Создать"),o=p({text:"",type:{type:"TEXT_ANSWER",name:"С одним правильным вариантом ответа"},level:0}),i=p([{content:"",correct:!0,type:"TEXT"},{content:"",correct:!1,type:"TEXT"}]),Y=p([{type:"ONE_ANSWER",name:"С одним правильным вариантом ответа"},{type:"MANY_ANSWERS",name:"С несколькими правильными вариантами ответа"},{type:"TEXT_ANSWER",name:"С текстовым ответом"}]),{data:E,pending:Ye,error:He,refresh:H}=O(`${A.public.apiBase}/tests/questions`,{onRequest({request:u,options:e}){e.headers=e.headers||{},e.headers.authorization=I("token").value}},"$9s31rgALdd"),{data:X,pending:Je,error:Ke,refresh:Ze}=O(`${A.public.apiBase}/tests/subjects`,{onRequest({request:u,options:e}){e.headers=e.headers||{},e.headers.authorization=I("token").value}},"$tb7JTUyid4");function M(u="",e="Создать"){w.value=!0,R.value=u,B.value=e}const J=u=>{const e={},h=[];u.forEach(r=>{e[r.id]={...r,children:[]}}),u.forEach(r=>{r.parentId!==null?e[r.parentId].children.push(e[r.id]):h.push(e[r.id])});const n=r=>{r.children.length===0?delete r.children:r.children.forEach(n)};return h.forEach(n),h};function K(){if(o.value.type.type==="ONE_ANSWER"&&i.value.forEach((n,r)=>{n.correct=r===m.value}),o.value.type.type==="MANY_ANSWERS"&&Array.isArray(m.value)){const n=i.value.map((r,_)=>({...r,correct:m.value.includes(_)}));i.value=n}o.value.type.type==="TEXT_ANSWER"&&(i.value=[i.value[0]]),f.value&&(o.value.subjectId=f.value.id),o.value.answers=i.value;const u=o.value.type;o.value.type=o.value.type.type;let e=`${A.public.apiBase}/tests/questions`,h="POST";j.value!==0&&(e=`${A.public.apiBase}/tests/questions/${j.value}`,h="PUT"),fetch(e,{method:h,headers:{Authorization:F.value,"Content-Type":"application/json"},body:JSON.stringify(o.value)}).then(n=>{switch(n.status){case 401:break;case 200:w.value=!1,R.value="",H(),m.value=0,i.value=[{content:"",correct:!0,type:"TEXT"},{content:"",correct:!1,type:"TEXT"}],o.value={text:"",type:{type:"TEXT_ANSWER",name:"С одним правильным вариантом ответа"},level:0};break}return n.json()}).then(n=>{n.error&&z.add({severity:"warn",summary:"Внимание",detail:n.error,life:3e3})}).catch(n=>{console.error("Невозможно отправить запрос",n)}),o.value.type=u}function Z(u){var h;const e=E.value.find(n=>n.id===u);i.value=e.answers,o.value={text:e.text,level:e.level,type:{type:e.type},answers:ce(i.value),subjectId:(h=e.subjects)==null?void 0:h.id},o.value.subjectId===void 0&&(o.value.subjectId=null),e.type==="ONE_ANSWER"&&(m.value=e.answers.findIndex(n=>n.correct===!0)),e.type==="MANY_ANSWERS"&&(m.value=e.answers.filter(n=>n.correct===!0).map((n,r)=>r)),j.value=e.id,M("Изменить вопрос","Сохранить")}const N=p();function ee(){N.value=E.value.filter(u=>u.text.includes(V.value))}function te(){N.value=E.value.filter(u=>u.subjectId===f.value.id)}return ae(()=>{E.value!==null&&(N.value=E.value),X.value!==null&&($.value=J(X.value))}),(u,e)=>{const h=ne,n=de,r=me,_=he,le=ve,oe=fe;return d(),v(S,null,[a(Ee,{onClose:e[8]||(e[8]=l=>w.value=!t(w)),modalActive:t(w),title:t(R)},{default:b(()=>[s("div",xe,[ke,Q(s("input",{type:"text",class:"inpt","onUpdate:modelValue":e[0]||(e[0]=l=>t(o).text=l)},null,512),[[D,t(o).text]]),ge,a(h,{modelValue:t(f),"onUpdate:modelValue":e[1]||(e[1]=l=>x(f)?f.value=l:null),variant:"filled",options:t($),optionLabel:"name",optionGroupLabel:"name",optionGroupChildren:["children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children","children"],style:{"min-width":"14rem"},placeholder:"Выбор темы"},null,8,["modelValue","options"]),Te,s("div",Ae,[(d(!0),v(S,null,q(t(G),l=>(d(),P(n,{class:"cursor-pointer mr-1",key:l,value:l,size:"large",severity:t(o).level===l?"":"secondary",onClick:c=>t(o).level=l},null,8,["value","severity","onClick"]))),128))]),s("div",Ve,[Ne,a(r,{modelValue:t(o).type,"onUpdate:modelValue":e[2]||(e[2]=l=>t(o).type=l),options:t(Y),optionLabel:"name",placeholder:"Выбрать тип",class:"w-full md:w-14rem"},null,8,["modelValue","options"])]),t(o).type.type==="TEXT_ANSWER"?(d(),v("p",Se,"Ответ:")):(d(),v("p",Ce,"Ответы:")),t(o).type.type==="ONE_ANSWER"?(d(),v("div",Re,[(d(!0),v(S,null,q(t(i),(l,c)=>(d(),v("div",$e,[s("div",je,[a(_,{type:"text",class:"w-full",placeholder:"Добавить вариант",modelValue:l.content,"onUpdate:modelValue":y=>l.content=y},null,8,["modelValue","onUpdate:modelValue"]),c!==0?(d(),P(t(C),{key:0,icon:"pi pi-trash",class:"p-button-primary",onClick:y=>t(i).splice(c,1)},null,8,["onClick"])):U("",!0)]),s("div",Ie,[a(le,{modelValue:t(m),"onUpdate:modelValue":e[3]||(e[3]=y=>x(m)?m.value=y:null),inputId:"radio"+c,name:"radio"+c,value:c},null,8,["modelValue","inputId","name","value"]),s("label",{for:"radio"+c,class:"ml-2"},"Правильный",8,qe)])]))),256)),a(_,{type:"text",class:"w-full",placeholder:"Добавить вариант",onClick:e[4]||(e[4]=l=>t(i).push({content:"",correct:!1,type:"TEXT"}))})])):t(o).type.type==="MANY_ANSWERS"?(d(),v("div",Pe,[(d(!0),v(S,null,q(t(i),(l,c)=>(d(),v("div",Ue,[s("div",We,[a(_,{type:"text",class:"w-full",placeholder:"Добавить вариант",modelValue:l.content,"onUpdate:modelValue":y=>l.content=y},null,8,["modelValue","onUpdate:modelValue"]),c!==0?(d(),P(t(C),{key:0,icon:"pi pi-trash",class:"p-button-primary",onClick:y=>t(i).splice(c,1)},null,8,["onClick"])):U("",!0)]),s("div",Le,[a(oe,{modelValue:t(m),"onUpdate:modelValue":e[5]||(e[5]=y=>x(m)?m.value=y:null),inputId:"radio"+c,name:"radio"+c,value:c},null,8,["modelValue","inputId","name","value"]),s("label",{for:"radio"+c,class:"ml-2"},"Правильный",8,Be)])]))),256)),a(_,{type:"text",class:"w-full",placeholder:"Добавить вариант",onClick:e[6]||(e[6]=l=>t(i).push({content:"",correct:!1,type:"TEXT"}))})])):t(o).type.type==="TEXT_ANSWER"?(d(),v("div",Xe,[a(_,{type:"text",class:"w-full",placeholder:"Добавить вариант",modelValue:t(i)[0].content,"onUpdate:modelValue":e[7]||(e[7]=l=>t(i)[0].content=l)},null,8,["modelValue"])])):U("",!0),a(we,{onClick:K},{default:b(()=>[W(L(t(B)),1)]),_:1})])]),_:1},8,["modalActive","title"]),s("div",Me,[s("div",Qe,[De,a(_e,{menuItems:[{text:"Вопросы",url:"/tests"},{text:"Конструктор теста",url:"/tests/create"}]}),s("div",Oe,[Q(s("input",{class:"inpt mr-2",type:"text","onUpdate:modelValue":e[9]||(e[9]=l=>x(V)?V.value=l:null),placeholder:"Поиск"},null,512),[[D,t(V)]]),s("button",{class:"btn",onClick:ee},"Найти")])]),s("div",ze,[a(t(C),{label:"Создать вопрос",onClick:e[10]||(e[10]=l=>M("Создать вопрос"))}),s("div",Fe,[a(h,{modelValue:t(f),"onUpdate:modelValue":e[11]||(e[11]=l=>x(f)?f.value=l:null),variant:"filled",options:t($),optionLabel:"name",optionGroupLabel:"name",optionGroupChildren:["children","children","children"],style:{"min-width":"14rem"},placeholder:"Выбор темы",onChange:te},null,8,["modelValue","options"])])]),a(t(be),{value:t(N),paginator:"",rows:50,rowsPerPageOptions:[10,50,100,150],class:"w-full",tableStyle:"min-width: 50rem",paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} to {last} of {totalRecords}"},{default:b(()=>[a(t(k),{field:"text",header:"Вопрос",style:{width:"25%"}}),a(t(k),{field:"level",header:"Сложность",style:{width:"25%"}}),a(t(k),{field:"subject",header:"Тема",style:{width:"25%"}},{body:b(l=>[W(L(l.data.subjects?l.data.subjects.name:""),1)]),_:1}),a(t(k),{header:"a(Дискр.)",style:{width:"25%"}},{body:b(l=>[W(L((Math.random()*3+-1).toFixed(2)),1)]),_:1}),a(t(k),{header:"Действия",style:{"min-width":"2rem"},class:"flex gap-2"},{body:b(l=>[a(t(C),{icon:"pi pi-pen-to-square",class:"p-button-primary m-5",onClick:c=>Z(l.data.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])])],64)}}},Rt=se(Ge,[["__scopeId","data-v-e0ef7802"]]);export{Rt as default};
