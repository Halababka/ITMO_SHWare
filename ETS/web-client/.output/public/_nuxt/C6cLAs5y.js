import T from"./wL0GXdHM.js";import{d as j,y as M,u as z,r as u,z as A,c as d,e as p,f as s,C as R,g as r,h as e,t as V,w as k,j as F,k as D,l as H,n as x,m as O,R as G,i as J,s as K,v as Q,x as W,p as X,_ as Y}from"./Bn8s6ksr.js";import Z from"./CJylbKRl.js";import{_ as ee}from"./CxKW6yKe.js";import se from"./v4Gjdufp.js";import ae from"./Bsd0B2of.js";import{u as le}from"./Ct7qimw6.js";import{u as L}from"./7jZtv5KM.js";import{f as oe}from"./ClO3DDpd.js";import{u as te,r as re}from"./CJ5fVYJb.js";import"./CaQe4QZp.js";import"./Beh2qRuB.js";import"./CVaRbyVJ.js";import"./DvLZ7Zqz.js";import"./BXRJdK4x.js";const i=b=>(Q("data-v-712bb1ed"),b=b(),W(),b),ie={class:"main-content white-box flex-col"},ne=i(()=>s("h2",null,"Профиль",-1)),de={class:"profile-info flex flex-col gap-3"},ue={class:"flex flex-wrap gap-3"},pe={class:"input-group flex-1"},ce=i(()=>s("label",{for:"first_name"},"Имя",-1)),me={class:"input-group flex-1"},fe=i(()=>s("label",{for:"last_name"},"Фамилия",-1)),_e={class:"input-group flex-1"},ve=i(()=>s("label",{for:"middle_name"},"Отчество",-1)),we={class:"input-group flex-1"},xe=i(()=>s("label",{for:"email"},"Email",-1)),be={class:"flex flex-wrap gap-3"},ge={class:"input-group flex-1 self-center"},he=i(()=>s("label",{for:"username"},"Логин",-1)),Ve={class:"input-group flex-1"},ye={class:"input-group flex-1"},ke=i(()=>s("label",{for:"about"},"О себе",-1)),Pe={class:"profile-actions"},Ue={key:0,class:"flex flex-col"},Ce=i(()=>s("span",{class:"text-3xl"},"Вы состоите в группах",-1)),De={class:"flex flex-col gap-3 p-0 flex-wrap"},Le={class:"flex flex-col gap-3 p-3"},$e={class:"input-group"},Se=i(()=>s("label",{for:"password"},"Пароль",-1)),qe={key:0,class:"p-error"},Be={class:"input-group"},Ee=i(()=>s("label",{for:"password"},"Новый пароль",-1)),Ie={key:0,class:"p-error"},Ne=j({__name:"profile",async setup(b){let g,P;le({title:"Профиль"});const{$toast:U}=X(),y=([g,P]=M(()=>L()),g=await g,P(),g).value;z("token");const o=u({}),f=u(!1),_=u(!1),v=u(!1),n=u(""),t=u({password:"",newPassword:""}),c=u(!1);A(()=>{y.pending||(o.value=Object.assign({},y.userData))});const $=()=>{t.value.password="",t.value.newPassword="",_.value=!1,c.value=!1},S=async()=>{try{f.value=!0,delete o.value.password,delete o.value.permissions,await te(o.value.id,o.value),await L(!0),U.add({severity:"success",summary:"Успешно",detail:"Данные обновлены",life:5e3})}catch(m){console.error("Error updating profile:",m)}finally{f.value=!1}},q=async()=>{if(c.value=!0,t.value.password&&t.value.newPassword){console.log(t.value.password,y.userData.password),f.value=!0;try{if(t.value.password===t.value.newPassword){n.value="Новый пароль должен отличаться от текущего",v.value=!0;return}await re(t.value.password,t.value.newPassword),n.value="",v.value=!1,U.add({severity:"success",summary:"Успешно",detail:"Пароль обновлен",life:5e3})}catch(m){if(console.error("Error change password:",m),m.status)switch(m.status){case 400:n.value="Некорректные данные, заполните поля";break;case 401:n.value="Введеный старый пароль не совпадает с текущим";break;case 404:n.value="Пользователь не найден";break;case 500:default:n.value="Внутренняя ошибка сервера"}else n.value="Произошла неизвестная ошибка";v.value=!0}finally{f.value=!1}}};return(m,a)=>{const w=T,h=K,B=Z,E=ee,C=se,I=ae;return d(),p(D,null,[s("div",ie,[ne,s("form",{class:"flex flex-col gap-4",onSubmit:R(S,["prevent"])},[s("div",de,[s("div",ue,[s("div",pe,[ce,r(w,{modelValue:e(o).first_name,"onUpdate:modelValue":a[0]||(a[0]=l=>e(o).first_name=l),id:"first_name",required:""},null,8,["modelValue"])]),s("div",me,[fe,r(w,{modelValue:e(o).last_name,"onUpdate:modelValue":a[1]||(a[1]=l=>e(o).last_name=l),id:"last_name",required:""},null,8,["modelValue"])]),s("div",_e,[ve,r(w,{modelValue:e(o).middle_name,"onUpdate:modelValue":a[2]||(a[2]=l=>e(o).middle_name=l),id:"middle_name"},null,8,["modelValue"])])]),s("div",we,[xe,r(w,{modelValue:e(o).email,"onUpdate:modelValue":a[3]||(a[3]=l=>e(o).email=l),id:"email"},null,8,["modelValue"])]),s("div",be,[s("div",ge,[he,r(w,{modelValue:e(o).username,"onUpdate:modelValue":a[4]||(a[4]=l=>e(o).username=l),id:"username",disabled:"",required:""},null,8,["modelValue"])]),s("div",Ve,[s("label",null,"Последний вход: "+V(e(oe)(e(o).lastLogin)),1),r(h,{for:"email",onClick:a[5]||(a[5]=l=>_.value=!0)},{default:k(()=>[F("Сменить пароль")]),_:1})])]),s("div",ye,[ke,r(B,{modelValue:e(o).about,"onUpdate:modelValue":a[6]||(a[6]=l=>e(o).about=l),id:"about",rows:"3"},null,8,["modelValue"])])]),s("div",Pe,[r(h,{label:"Сохранить изменения",type:"submit"})])],32),e(o).groups.length>0?(d(),p("div",Ue,[Ce,s("ul",De,[(d(!0),p(D,null,H(e(o).groups,(l,N)=>(d(),p("li",{key:N,class:"group flex flex-col justify-center"},[s("div",null,[s("div",null,V(l.full_name),1),s("div",null,V(l.abbreviation),1)])]))),128))])])):x("",!0)]),e(f)?(d(),O(E,{key:0})):x("",!0),r(I,{visible:e(_),"onUpdate:visible":a[10]||(a[10]=l=>J(_)?_.value=l:null),style:{width:"450px"},header:"Смена пароля",modal:!0,class:"p-fluid",closable:!1},{footer:k(()=>[r(h,{label:"Отмена",icon:"pi pi-times",text:"",onClick:$}),r(h,{label:"Отправить",icon:"pi pi-check",text:"",onClick:a[9]||(a[9]=l=>q())})]),default:k(()=>[s("div",Le,[e(v)?(d(),p("div",{key:0,class:"error-block",style:G([e(v)?{opacity:1,padding:"16px"}:{opacity:0}])},[s("span",null,V(e(n)),1)],4)):x("",!0),s("div",$e,[Se,r(C,{id:"password","pt:input:root:class":"w-full",modelValue:e(t).password,"onUpdate:modelValue":a[7]||(a[7]=l=>e(t).password=l),feedback:!1,required:"",toggleMask:"",invalid:e(c)&&!e(t).password,autofocus:""},null,8,["modelValue","invalid"]),e(c)&&!e(t).password?(d(),p("small",qe,"Поле обязательно для заполнения.")):x("",!0)]),s("div",Be,[Ee,r(C,{id:"password","pt:input:root:class":"w-full",modelValue:e(t).newPassword,"onUpdate:modelValue":a[8]||(a[8]=l=>e(t).newPassword=l),feedback:!0,required:"",weakLabel:"Слабый",mediumLabel:"Средний",strongLabel:"Сильный",promptLabel:"Введите пароль",toggleMask:"",invalid:e(c)&&!e(t).newPassword},null,8,["modelValue","invalid"]),e(c)&&!e(t).newPassword?(d(),p("small",Ie,"Поле обязательно для заполнения.")):x("",!0)])])]),_:1},8,["visible"])],64)}}}),Ye=Y(Ne,[["__scopeId","data-v-712bb1ed"]]);export{Ye as default};
