import{b as oe,r,o as ie,e as h,f as a,g as s,w as n,h as o,i as k,k as M,F as se,c,j as D,l as ae,m as ne,q as re,t as f,n as I,s as de,p as ue}from"./Bn8s6ksr.js";import pe from"./DREYMDR6.js";import me from"./DhRU5Jgb.js";import ce from"./wL0GXdHM.js";import fe from"./Cj5F3lRc.js";import ve from"./B0mp-r-t.js";import _e from"./BBuG_LZR.js";import ge from"./CY5I-LVS.js";import he from"./CJylbKRl.js";import be from"./Xh5iAUju.js";import ke from"./4am-JueE.js";import ye from"./Bsd0B2of.js";import{u as xe}from"./Ct7qimw6.js";import{g as Ve,c as Ce,d as z}from"./pcZBtJnj.js";import{f as Le}from"./CcyV51U7.js";import{e as we,g as Re}from"./C0BDY4bg.js";import{a as $e}from"./ClO3DDpd.js";import"./BarrcHik.js";import"./B2cK24SD.js";import"./CP2X2kCJ.js";import"./okssMqCN.js";import"./DvLZ7Zqz.js";import"./CGQTC3f5.js";import"./Beh2qRuB.js";import"./CVaRbyVJ.js";import"./cLBxPfJA.js";import"./C9DUTysQ.js";import"./8sW4mJZM.js";import"./DwA5qEtX.js";import"./BXQHskyo.js";import"./Co_e_0iK.js";import"./B7j0Dt9D.js";import"./BFrbZsHQ.js";import"./CQy9NsTI.js";import"./7fOzFieg.js";import"./BmCDhavC.js";const De={class:"main-content"},Ne={class:"card"},Ue={class:"flex flex-wrap gap-3 items-center justify-between mb-3"},Pe={class:"flex items-center gap-3"},Se=a("h4",{class:"m-0 text-xl text-900 font-bold"},"Управление регистрационными ссылками",-1),Te=a("i",{class:"pi pi-search"},null,-1),Fe={class:"field my-3"},Me=a("label",{for:"name"},"Название*",-1),Ie={class:"field my-3"},ze=a("label",{for:"description"},"Описание",-1),Be={class:"field my-3"},je=a("label",{for:"remaining_usages"},"Число макимальных использований*",-1),Ae={class:"field my-3"},Ge=a("label",{for:"role"},"Роль",-1),Oe={class:"field my-3"},qe=a("label",{for:"groups"},"Группы",-1),Ee={class:"flex flex-col justify-center flex-wrap"},He={class:"confirmation-content p-3"},Ke=a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Je={key:0},Qe={style:{"font-size":"0.90rem"}},We={class:"confirmation-content p-3"},Xe=a("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Ye={key:0},Mt={__name:"index",setup(Ze){xe({title:"Управление ссылками регистрации"}),oe();const{$toast:y}=ue(),N=r(),u=r([]),v=r(!1),_=r(!1),g=r(!1),i=r({}),p=r([]),x=r({global:{value:null,matchMode:se.CONTAINS}}),V=r(!1),C=r([]),U=r([]),L=r(!0),w=r([{field:"name",header:"Название"},{field:"description",header:"Описание"},{field:"role.name",header:"Роль"},{field:"groups",header:"Группы"},{field:"remaining_usages",header:"Оставшиеся использования"},{field:"url",header:"URL"},{field:"created_at",header:"Дата создания"},{field:"updated_at",header:"Дата обновления"}]),b=r(w.value.filter(l=>l.field!=="updated_at")),B=()=>{i.value={},V.value=!1,v.value=!0},j=()=>{v.value=!1,V.value=!1},A=()=>{var l;V.value=!0,(l=i==null?void 0:i.value.name)!=null&&l.trim()&&(i.value.id||(console.log(i.value),Ce(i.value).then(e=>{console.log(e),u.value.push(e),y.add({severity:"success",summary:"Успешно",detail:"Ссылка создана",life:3e3})}).catch(e=>console.error("Ошибка при создании ссылки:",e))),v.value=!1,i.value={})},G=l=>{i.value=l,_.value=!0},O=()=>{z([i.value.id]).then(l=>{u.value=u.value.filter(e=>e.id!==i.value.id),_.value=!1,i.value={},y.add({severity:"success",summary:"Успешно",detail:"Ссылка удалена",life:3e3})}).catch(l=>console.error("Ошибка при удалении ссылки:",l))},q=()=>{N.value.exportCSV()},E=()=>{g.value=!0},H=()=>{z(p.value.map(l=>l.id)).then(l=>{u.value=u.value.filter(e=>!p.value.includes(e)),g.value=!1,p.value=null,y.add({severity:"success",summary:"Успешно",detail:"Ссылки удалены",life:3e3})}).catch(l=>console.error("Ошибка при удалении ссылок:",l))},K=l=>{b.value=w.value.filter(e=>l.includes(e))},J=l=>l?l.name:"Роли нету",P=()=>{L.value=!0,Ve().then(l=>{u.value=l.links.map(e=>({...e})),u.value=$e(u.value),L.value=!1}).catch(l=>console.error("Ошибка при получении ссылок:",l))},Q=l=>{const e=C.value.find(d=>d.name===l);e&&(i.value.role=e)};return ie(()=>{P(),Le().then(l=>{C.value=l}).catch(l=>console.error("Ошибка при получении ролей:",l)),we().then(l=>{U.value=l}).catch(l=>console.error("Ошибка при получении групп:",l))}),(l,e)=>{const d=de,W=pe,X=me,S=ce,Y=fe,T=ve,R=_e,Z=ge,ee=he,te=be,le=ke,$=ye;return c(),h(M,null,[a("div",De,[a("div",Ne,[s(W,{class:"mb-4"},{start:n(()=>[s(d,{label:"Добавить",icon:"pi pi-plus",severity:"success",class:"mr-2",onClick:B}),s(d,{label:"Удалить",icon:"pi pi-trash",severity:"danger",onClick:E,disabled:!o(p)||!o(p).length},null,8,["disabled"])]),end:n(()=>[s(d,{label:"Экспорт",icon:"pi pi-upload",severity:"help",onClick:e[0]||(e[0]=t=>q(t))})]),_:1}),s(Z,{ref_key:"dt",ref:N,value:o(u),selection:o(p),"onUpdate:selection":e[3]||(e[3]=t=>k(p)?p.value=t:null),dataKey:"id",loading:o(L),style:{"max-width":"1500px"},tableStyle:"min-width: 60rem",showGridlines:"",resizableColumns:"",columnResizeMode:"fit",paginator:!0,rows:10,filters:o(x),paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,25,50],currentPageReportTemplate:"Показаны {first} до {last} из {totalRecords}"},{header:n(()=>[a("div",Ue,[a("div",Pe,[Se,s(d,{icon:"pi pi-refresh",rounded:"",raised:"",onClick:P})]),s(Y,{iconPosition:"left"},{default:n(()=>[s(X,null,{default:n(()=>[Te]),_:1}),s(S,{modelValue:o(x).global.value,"onUpdate:modelValue":e[1]||(e[1]=t=>o(x).global.value=t),placeholder:"Поиск..."},null,8,["modelValue"])]),_:1})]),s(T,{modelValue:o(b),"onUpdate:modelValue":[e[2]||(e[2]=t=>k(b)?b.value=t:null),K],options:o(w),optionLabel:"header",display:"chip",placeholder:"Выберите колонки"},null,8,["modelValue","options"])]),empty:n(()=>[D(" Ссылки не найдены")]),default:n(()=>[s(R,{selectionMode:"multiple",style:{width:"3rem"},exportable:!1}),(c(!0),h(M,null,ae(o(b),(t,F)=>(c(),ne(R,{sortable:"",field:t.field,header:t.header,key:t.field+"_"+F},re({_:2},[t.field!=="groups"&&t.field!=="role.name"?{name:"body",fn:n(m=>[a("span",null,f(m.data[t.field]),1)]),key:"0"}:t.field==="role.name"?{name:"body",fn:n(m=>[a("span",null,f(J(m.data.role)),1)]),key:"1"}:t.field==="groups"?{name:"body",fn:n(m=>[m.data.groups&&m.data.groups.length?(c(),h("span",{key:0},f(o(Re)(m.data.groups)),1)):(c(),h("span",{key:1},"Групп нет"))]),key:"2"}:void 0]),1032,["field","header"]))),128)),s(R,{exportable:!1,style:{"min-width":"2rem"}},{body:n(t=>[s(d,{icon:"pi pi-trash",rounded:"",raised:"",severity:"danger",onClick:F=>G(t.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","loading","filters"])])]),s($,{visible:o(v),"onUpdate:visible":e[8]||(e[8]=t=>k(v)?v.value=t:null),style:{width:"450px"},modal:!0,header:"Детали ссылки",class:"p-fluid"},{footer:n(()=>[s(d,{label:"Отмена",icon:"pi pi-times",text:"",onClick:j}),s(d,{label:"Сохранить",icon:"pi pi-check",text:"",onClick:A})]),default:n(()=>[a("div",Fe,[Me,s(S,{id:"name",modelValue:o(i).name,"onUpdate:modelValue":e[4]||(e[4]=t=>o(i).name=t),required:"",autoFocus:"",class:"mt-2"},null,8,["modelValue"])]),a("div",Ie,[ze,s(ee,{id:"description",modelValue:o(i).description,"onUpdate:modelValue":e[5]||(e[5]=t=>o(i).description=t),modelModifiers:{trim:!0},rows:"3",class:"mb-0 my-2"},null,8,["modelValue"])]),a("div",Be,[je,s(te,{id:"remaining_usages",modelValue:o(i).remaining_usages,"onUpdate:modelValue":e[6]||(e[6]=t=>o(i).remaining_usages=t),class:"mt-2"},null,8,["modelValue"])]),a("div",Ae,[Ge,s(le,{class:"mt-2",id:"role",modelValue:o(i).role?o(i).role.name:"","onUpdate:modelValue":Q,options:o(C).map(t=>t.name),placeholder:"Выберите роль"},null,8,["modelValue","options"])]),a("div",Oe,[qe,s(T,{class:"mt-2",modelValue:o(i).groups,"onUpdate:modelValue":e[7]||(e[7]=t=>o(i).groups=t),options:o(U),optionLabel:"abbreviation",filter:!0,filterFields:["full_name","abbreviation"],display:"chip",placeholder:"Выберите группы"},{option:n(t=>[a("div",Ee,[a("div",null,f(t.option.full_name),1),a("div",null,f(t.option.abbreviation),1)])]),_:1},8,["modelValue","options"])])]),_:1},8,["visible"]),s($,{visible:o(_),"onUpdate:visible":e[10]||(e[10]=t=>k(_)?_.value=t:null),style:{width:"500px"},header:"Подтверждение",modal:!0},{footer:n(()=>[s(d,{label:"Нет",icon:"pi pi-times",text:"",onClick:e[9]||(e[9]=t=>_.value=!1)}),s(d,{label:"Да",icon:"pi pi-check",text:"",onClick:O})]),default:n(()=>[a("div",He,[Ke,o(i)?(c(),h("span",Je,[D("Вы действительно хотите удалить пользователя "),a("b",null,f(o(i).name),1),D(),a("span",Qe,f(o(i).created_at)+"?",1)])):I("",!0)])]),_:1},8,["visible"]),s($,{visible:o(g),"onUpdate:visible":e[12]||(e[12]=t=>k(g)?g.value=t:null),style:{width:"450px"},header:"Подтверждение",modal:!0},{footer:n(()=>[s(d,{label:"Нет",icon:"pi pi-times",text:"",onClick:e[11]||(e[11]=t=>g.value=!1)}),s(d,{label:"Да",icon:"pi pi-check",text:"",onClick:H})]),default:n(()=>[a("div",We,[Xe,o(i)?(c(),h("span",Ye,"Вы действительно хотите удалить выделенные ссылки?")):I("",!0)])]),_:1},8,["visible"])],64)}}};export{Mt as default};
