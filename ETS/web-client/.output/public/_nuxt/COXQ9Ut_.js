import{u as ne,a as re,_ as de,b as ue,r,o as ce,e as O,f as i,g as o,w as n,h as a,i as g,F as S,c as P,t as b,m as j,j as I,n as pe,k as me,l as fe,q as ve,s as be,v as he,x as ge,p as _e}from"./Bn8s6ksr.js";import xe from"./DREYMDR6.js";import ye from"./DhRU5Jgb.js";import ke from"./wL0GXdHM.js";import we from"./Cj5F3lRc.js";import Ce from"./B0mp-r-t.js";import Re from"./BBuG_LZR.js";import Ve from"./CY5I-LVS.js";import Pe from"./Bsd0B2of.js";import{u as Ie}from"./Ct7qimw6.js";import{f as Le,u as Ne,c as Te,d as K}from"./CcyV51U7.js";import"./BarrcHik.js";import"./B2cK24SD.js";import"./CP2X2kCJ.js";import"./okssMqCN.js";import"./DvLZ7Zqz.js";import"./CGQTC3f5.js";import"./Beh2qRuB.js";import"./CVaRbyVJ.js";import"./cLBxPfJA.js";import"./C9DUTysQ.js";import"./8sW4mJZM.js";import"./4am-JueE.js";import"./Xh5iAUju.js";import"./7fOzFieg.js";import"./BmCDhavC.js";import"./DwA5qEtX.js";import"./BXQHskyo.js";import"./Co_e_0iK.js";import"./B7j0Dt9D.js";import"./BFrbZsHQ.js";import"./CQy9NsTI.js";const $e=re(),De=u=>u.map(m=>m.name).join(", "),Fe=async()=>{try{const u=await fetch(`${$e.public.apiBase}/permissions`,{headers:{Authorization:`${ne("token").value}`}});if(!u.ok)throw new Error("Failed to fetch permissions");return await u.json()}catch(u){throw console.error("Error fetching permissions:",u),u}},h=u=>(he("data-v-d716a9b7"),u=u(),ge(),u),Se={class:"main-content flex-col"},Ue={class:"card"},Be=h(()=>i("span",{class:"text-lg"},"Роли не найдены",-1)),Ee={class:"flex flex-wrap gap-3 items-center justify-between mb-3"},Me={class:"flex items-center gap-3"},Ae=h(()=>i("h4",{class:"m-0 text-xl text-900 font-bold"},"Управление ролями",-1)),Oe=h(()=>i("i",{class:"pi pi-search"},null,-1)),je={class:"m-0 mb-2"},Ke={class:"field"},ze=h(()=>i("label",{for:"name"},"Наименование",-1)),qe={class:"field"},He=h(()=>i("label",{for:"code"},"Код",-1)),Ge={class:"field"},Je=h(()=>i("label",{for:"permissions"},"Разрешения",-1)),Qe={class:"flex flex-col justify-center flex-wrap"},We={class:"confirmation-content p-3"},Xe=h(()=>i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Ye=h(()=>i("div",{class:"confirmation-content p-3"},[i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),i("span",null,"Вы уверены, что хотите удалить выбранные роли?")],-1)),Ze={__name:"index",setup(u){Ie({title:"Администрирование ролей"}),ue();const m=r(!0),{$toast:C}=_e(),U=r(),p=r(),f=r(!1),_=r(!1),x=r(!1),s=r({}),v=r(),L=r({global:{value:null,matchMode:S.CONTAINS}});r({global:{value:null,matchMode:S.CONTAINS}});const N=r({name:{value:null,matchMode:S.CONTAINS}}),T=r(!1),B=r([]);r([{label:"ACTIVE",value:"active"},{label:"INACTIVE",value:"inactive"},{label:"BLOCKED",value:"blocked"}]);const $=r([{field:"name",header:"Наименование"},{field:"code",header:"Код"},{field:"permissions",header:"Права"}]),w=r($.value.filter(t=>t.field!=="permissions")),R=r({});r(),r();const z=r([{field:"name",header:"Наименование"},{field:"code",header:"Код"}]);r(z.value.filter(t=>t.field!=="code"));const q=()=>{s.value={},T.value=!1,f.value=!0},H=()=>{f.value=!1,T.value=!1},G=()=>{var t;T.value=!0,(t=s==null?void 0:s.value.name)!=null&&t.trim()&&(s.value.id?Ne(s.value.id,s.value).then(e=>{p.value[X(s.value.id)]=e,C.add({severity:"success",summary:"Успешно",detail:"Роль обновлена",life:5e3}),f.value=!1,s.value={},D()}).catch(e=>console.error("Ошибка обновления роли:",e)):Te(s.value).then(e=>{p.value.push(e),C.add({severity:"success",summary:"Успешно",detail:"Роль создана",life:5e3})}).catch(e=>console.error("Ошибка создания роли:",e)),f.value=!1,s.value={})},J=t=>{s.value={...t},f.value=!0},Q=t=>{s.value=t,_.value=!0},W=()=>{K([s.value.id]).then(t=>{p.value=p.value.filter(e=>e.id!==s.value.id),_.value=!1,s.value={},C.add({severity:"success",summary:"Успешно",detail:"Роль удалена",life:5e3})}).catch(t=>console.error("Ошибка удаления роли:",t))},X=t=>{let e=-1;for(let d=0;d<p.value.length;d++)if(p.value[d].id===t){e=d;break}return e},Y=()=>{U.value.exportCSV()},Z=()=>{x.value=!0},ee=()=>{K(v.value.map(t=>t.id)).then(t=>{p.value=p.value.filter(e=>!v.value.includes(e)),x.value=!1,v.value=null,C.add({severity:"success",summary:"Успешно",detail:"Роли удалены",life:5e3})}).catch(t=>console.error("Ошибка удаления ролей:",t))},le=t=>{w.value=$.value.filter(e=>t.includes(e))};function D(){m.value=!0,Le().then(t=>{p.value=t,m.value=!1}).catch(t=>console.error("Ошибка получения ролей:",t))}function te(){m.value=!0,Fe().then(t=>{B.value=t,m.value=!1}).catch(t=>console.error("Ошибка получения разрешений:",t)).finally(()=>{m.value=!1})}return ce(()=>{D(),te()}),(t,e)=>{const d=be,oe=xe,ae=ye,V=ke,se=we,E=Ce,y=Re,M=Ve,F=Pe;return P(),O("div",Se,[i("div",Ue,[o(oe,{class:"mb-4"},{start:n(()=>[o(d,{label:"Добавить",icon:"pi pi-plus",severity:"success",class:"mr-2",onClick:q}),o(d,{label:"Удалить",icon:"pi pi-trash",severity:"danger",onClick:Z,disabled:!a(v)||!a(v).length},null,8,["disabled"])]),end:n(()=>[o(d,{label:"Экспорт",icon:"pi pi-upload",class:"inline-block",onClick:Y})]),_:1}),o(M,{expandedRows:a(R),"onUpdate:expandedRows":e[3]||(e[3]=l=>g(R)?R.value=l:null),selection:a(v),"onUpdate:selection":e[4]||(e[4]=l=>g(v)?v.value=l:null),ref_key:"dt",ref:U,loading:a(m),value:a(p),selectionMode:"checkbox",dataKey:"id",paginator:!0,rows:10,rowsPerPageOptions:[10,25,50],filters:a(L),filterDisplay:"menu",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Показаны {first} до {last} из {totalRecords}",responsiveLayout:"scroll",globalFilterFields:["name","email"],rowExpansionTemplate:"expandedRowTemplate",expandedRowKeys:a(R)},{empty:n(()=>[Be]),header:n(()=>[i("div",Ee,[i("div",Me,[Ae,o(d,{icon:"pi pi-refresh",rounded:"",raised:"",onClick:D})]),o(se,{iconPosition:"left"},{default:n(()=>[o(ae,null,{default:n(()=>[Oe]),_:1}),o(V,{modelValue:a(L).global.value,"onUpdate:modelValue":e[0]||(e[0]=l=>a(L).global.value=l),placeholder:"Поиск..."},null,8,["modelValue"])]),_:1})]),o(E,{modelValue:a(w),"onUpdate:modelValue":[e[1]||(e[1]=l=>g(w)?w.value=l:null),le],options:a($),optionLabel:"header",display:"chip",placeholder:"Выберите колонки"},null,8,["modelValue","options"])]),expansion:n(l=>{var k;return[i("div",null,[i("h4",je,"Права роли "+b(l.data.name),1),((k=l.data.permissions)==null?void 0:k.length)!==0?(P(),j(M,{key:0,filters:a(N),"onUpdate:filters":e[2]||(e[2]=c=>g(N)?N.value=c:null),filterDisplay:"row",globalFilterFields:["name"],value:l.data.permissions,paginator:!0,rows:20,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[20,40,80],currentPageReportTemplate:"Показаны {first} до {last} из {totalRecords}"},{default:n(()=>[o(y,{field:"name",header:"Название"},{body:n(c=>[I(b(c.data.name),1)]),filter:n(({filterModel:c,filterCallback:ie})=>[o(V,{modelValue:c.value,"onUpdate:modelValue":A=>c.value=A,type:"text",onInput:A=>ie(),class:"p-column-filter",placeholder:"Поиск по названию"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),o(y,{field:"code",header:"Код"},{body:n(c=>[I(b(c.data.code),1)]),_:2},1024)]),_:2},1032,["filters","value"])):pe("",!0)])]}),default:n(()=>[o(y,{expander:"",style:{width:"3rem"}}),o(y,{selectionMode:"multiple",style:{width:"3rem"},exportable:!1}),(P(!0),O(me,null,fe(a(w),(l,k)=>(P(),j(y,{sortable:"",field:l.field,header:l.header,key:l.field+"_"+k},ve({_:2},[l.field!=="permissions"?{name:"body",fn:n(c=>[I(b(c.data[l.field]),1)]),key:"0"}:l.field==="permissions"?{name:"body",fn:n(c=>[I(b(a(De)(c.data.permissions)),1)]),key:"1"}:void 0]),1032,["field","header"]))),128)),o(y,{exportable:!1,style:{"min-width":"8rem"}},{body:n(l=>[o(d,{icon:"pi pi-pencil",outlined:"",rounded:"",class:"mr-2",onClick:k=>J(l.data)},null,8,["onClick"]),o(d,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:k=>Q(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["expandedRows","selection","loading","value","filters","expandedRowKeys"])]),o(F,{visible:a(f),"onUpdate:visible":e[8]||(e[8]=l=>g(f)?f.value=l:null),header:"Детали роли",modal:!0,style:{width:"450px"},class:"p-fluid"},{footer:n(()=>[o(d,{label:"Отмена",icon:"pi pi-times",class:"p-button-text",onClick:H}),o(d,{label:"Сохранить",icon:"pi pi-check",class:"p-button-text",onClick:G})]),default:n(()=>[i("div",Ke,[ze,o(V,{id:"name",modelValue:a(s).name,"onUpdate:modelValue":e[5]||(e[5]=l=>a(s).name=l),required:"",autoFocus:""},null,8,["modelValue"])]),i("div",qe,[He,o(V,{id:"code",modelValue:a(s).code,"onUpdate:modelValue":e[6]||(e[6]=l=>a(s).code=l)},null,8,["modelValue"])]),i("div",Ge,[Je,o(E,{class:"mt-2",modelValue:a(s).permissions,"onUpdate:modelValue":e[7]||(e[7]=l=>a(s).permissions=l),options:a(B),optionLabel:"name",filter:!0,filterFields:["name","code"],display:"chip",placeholder:"Выберите разрешения",id:"permissions"},{option:n(l=>[i("div",Qe,[i("div",null,b(l.option.name),1),i("div",null,b(l.option.code),1)])]),_:1},8,["modelValue","options"])])]),_:1},8,["visible"]),o(F,{visible:a(_),"onUpdate:visible":e[10]||(e[10]=l=>g(_)?_.value=l:null),header:"Подтвердить",modal:!0},{footer:n(()=>[o(d,{label:"Нет",icon:"pi pi-times",class:"p-button-text",onClick:e[9]||(e[9]=l=>_.value=!1)}),o(d,{label:"Да",icon:"pi pi-check",class:"p-button-text",onClick:W})]),default:n(()=>[i("div",We,[Xe,i("span",null,"Вы уверены, что хотите удалить "+b(a(s).name)+"?",1)])]),_:1},8,["visible"]),o(F,{visible:a(x),"onUpdate:visible":e[12]||(e[12]=l=>g(x)?x.value=l:null),header:"Подтвердить",modal:!0},{footer:n(()=>[o(d,{label:"Нет",icon:"pi pi-times",class:"p-button-text",onClick:e[11]||(e[11]=l=>x.value=!1)}),o(d,{label:"Да",icon:"pi pi-check",class:"p-button-text",onClick:ee})]),default:n(()=>[Ye]),_:1},8,["visible"])])}}},$l=de(Ze,[["__scopeId","data-v-d716a9b7"]]);export{$l as default};
